{
  "name": "Agente Cidadao - Multi-Agentes",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "3c9454b2-5775-4e2b-aceb-498e5c14cc7f",
      "name": "Webhook Chat",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -1312,
        96
      ],
      "webhookId": "a23384a3-5018-4dfd-a6cc-e9bcd5eded3f"
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.agente }}",
        "rules": {
          "rules": [
            {
              "value2": "legislativo"
            },
            {
              "value2": "politico",
              "output": 1
            },
            {
              "value2": "fiscal",
              "output": 2
            }
          ]
        }
      },
      "id": "d7ccc8ae-fb2f-43e3-8545-0ce54046bb27",
      "name": "Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        -192,
        80
      ]
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Legislativo"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5bc93e94-b912-4555-8b5c-30b6f21d14ee",
      "name": "Log: Leg Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -48,
        -48
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Pol√≠tico"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5faa6a05-798d-4afa-8c9f-237caf94eff8",
      "name": "Log: Pol Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -48,
        256
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Fiscal"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5c25f030-41d8-4c56-af39-b9a7c75db75a",
      "name": "Log: Fis Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -64,
        528
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "requests",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "completed"
            },
            {
              "fieldId": "final_response",
              "fieldValue": "={{ $json.output }}"
            }
          ]
        }
      },
      "id": "a3951e3c-1a8a-4164-8c97-e503d6af3ec8",
      "name": "Supabase: Final Update",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1600,
        -256
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_deputados",
          "detalhar_deputado",
          "despesas_deputado",
          "discursos_deputado",
          "eventos_deputado",
          "frentes_deputado",
          "ocupacoes_deputado",
          "orgaos_deputado",
          "profissoes_deputado",
          "analise_presenca_deputado",
          "buscar_partidos",
          "detalhar_partido",
          "membros_partido",
          "lideres_partido",
          "buscar_orgaos",
          "membros_orgao",
          "buscar_frentes",
          "ufs",
          "tipos_orgao",
          "membros_frente",
          "mesa_legislatura",
          "sugerir_ferramentas",
          "resumo_discursos_deputado",
          "ranking_partidos_tamanho"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        432,
        416
      ],
      "id": "3d432f25-8da6-425d-ba5d-46503401f87e",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{ $('Webhook Chat').item.json.body.record.content }}\n\n{{ $('Webhook Chat').item.json.body.record.context && typeof $('Webhook Chat').item.json.body.record.context === 'object' && !Array.isArray($('Webhook Chat').item.json.body.record.context) && Object.keys($('Webhook Chat').item.json.body.record.context).length > 0 ? 'CONTEXTO: ' + JSON.stringify($('Webhook Chat').item.json.body.record.context) : '' }}",
        "options": {
          "systemMessage": "=## INSTRU√á√ïES DE CONTEXTO\n\nVoc√™ pode receber um objeto CONTEXTO junto com a pergunta do usu√°rio. Este contexto cont√©m:\n- previous_questions: lista das √∫ltimas perguntas feitas pelo usu√°rio\n- entities_in_focus: entidades mencionadas anteriormente (deputados, proposi√ß√µes, partidos)\n\n**REGRAS OBRIGAT√ìRIAS:**\n1. Se o usu√°rio usar pronomes (ele, ela, isso, esse, este), consulte entities_in_focus para identificar a quem se refere\n2. Se entities_in_focus.deputado existir e a pergunta for sobre \"ele\" ou sobre gastos/despesas, use o ID do deputado do contexto\n3. Se a pergunta for amb√≠gua, assuma que se refere √† √∫ltima entidade mencionada\n4. Passe o contexto relevante para os agentes especialistas\n\n---\n\nVoc√™ √© o Orquestrador do Agente Cidad√£o. Sua fun√ß√£o √© analisar a pergunta do usu√°rio e decidir quais agentes especialistas devem ser acionados.\n\n## AGENTES DISPON√çVEIS\n- **legislativo**: Proposi√ß√µes, projetos de lei (PL, PEC, PLP), tramita√ß√µes, vota√ß√µes, emendas, leis sobre temas espec√≠ficos\n- **politico**: Deputados federais, partidos pol√≠ticos, bancadas estaduais, perfil de parlamentares, mesa diretora, presidente da C√¢mara, lideran√ßas, **comiss√µes e √≥rg√£os da C√¢mara**, membros de comiss√µes\n- **fiscal**: Despesas parlamentares, cota CEAP, gastos com gabinete, viagens, combust√≠vel, alimenta√ß√£o\n\n## REGRAS DE DECIS√ÉO\n1. Perguntas sobre \"quem s√£o os deputados\" ou \"deputados de X estado/partido\" ‚Üí **politico**\n2. Perguntas sobre \"leis\", \"projetos\", \"PEC\", \"proposi√ß√µes\", \"tramita√ß√£o\" ‚Üí **legislativo**\n3. Perguntas sobre \"gastos\", \"despesas\", \"quanto gastou\", \"verbas\" ‚Üí **fiscal**\n4. Perguntas que misturam temas ‚Üí use **m√∫ltiplos agentes**\n5. Em caso de d√∫vida sobre deputados E gastos ‚Üí use **[\"politico\", \"fiscal\"]**\n6. Se o CONTEXTO mencionar um deputado e a pergunta usar \"ele/ela\" + gastos ‚Üí **[\"fiscal\"]** (o ID j√° est√° no contexto)\n7. Perguntas sobre \"presidente da C√¢mara\", \"mesa diretora\", \"lideran√ßa\" ‚Üí **politico**\n8. Perguntas sobre \"comiss√£o\", \"membros da comiss√£o\", \"quem est√° na comiss√£o\" ‚Üí **politico**\n\n## EXEMPLOS\n- \"Deputados do Amazonas\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"Projetos sobre educa√ß√£o\" ‚Üí {\"agentes\": [\"legislativo\"]}\n- \"Quanto o deputado X gastou\" ‚Üí {\"agentes\": [\"politico\", \"fiscal\"]}\n- \"PECs de 2024\" ‚Üí {\"agentes\": [\"legislativo\"]}\n- \"Quanto ele gastou?\" (com deputado no contexto) ‚Üí {\"agentes\": [\"fiscal\"]}\n- \"Quem √© o presidente da C√¢mara?\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"Quem comp√µe a mesa diretora?\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"De que fala [Nome]?\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"Membros da comiss√£o de educa√ß√£o\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"Quem est√° na CCTI?\" ‚Üí {\"agentes\": [\"politico\"]}\n\nResponda APENAS um JSON no formato:\n{\n  \"agentes\": [\"legislativo\", \"fiscal\"]\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -944,
        -144
      ],
      "id": "61a1270e-6994-4816-b839-4736315ea755",
      "name": "Orquestador"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{ $json.chatInput || $json.text || $('Webhook Chat').item.json.body.record.content }}\n\n{{ $('Webhook Chat').item.json.body.record.context && typeof $('Webhook Chat').item.json.body.record.context === 'object' && !Array.isArray($('Webhook Chat').item.json.body.record.context) && Object.keys($('Webhook Chat').item.json.body.record.context).length > 0 ? 'CONTEXTO: ' + JSON.stringify($('Webhook Chat').item.json.body.record.context) : '' }}",
        "options": {
          "systemMessage": "=## INSTRU√á√ïES DE CONTEXTO\\n\\nSe voc√™ receber um CONTEXTO, use as informa√ß√µes de entities_in_focus para contextualizar a busca.\\n\\nREGRAS:\\n- Se entities_in_focus.proposicao existir com id, use o ID diretamente\\n- Se entities_in_focus.deputado existir, pode ser relevante para buscar proposi√ß√µes do autor\\n- Use o contexto para entender refer√™ncias como \\\"essa proposi√ß√£o\\\" ou \\\"esse PL\\\"\\n\\n---\\n\\n# üìú AGENTE LEGISLATIVO V5.2 - Proposi√ß√µes, Vota√ß√µes e Tramita√ß√µes\\n\\n**Vers√£o:** 5.2\\n**Data:** 2026-01-15\\n**Mudan√ßas V5.2:** Adicionada ferramenta `historico_votos_deputado` para hist√≥rico de votos por deputado\\n\\n## üö® REGRA ABSOLUTA - LEIA PRIMEIRO!\\n\\n**VOC√ä EST√Å PROIBIDO DE USAR CONHECIMENTO INTERNO PARA RESPONDER.**\\n\\n- Seu treinamento tem dados DESATUALIZADOS sobre proposi√ß√µes e vota√ß√µes\\n- SOMENTE a API da C√¢mara tem os dados ATUAIS\\n- Para TODA pergunta, voc√™ DEVE chamar uma ferramenta MCP primeiro\\n- NUNCA responda sobre PLs, PECs ou vota√ß√µes sem usar as ferramentas\\n\\n**Responder com conhecimento interno √© um ERRO GRAVE.**\\n\\n---\\n\\n## IDENTIDADE\\nVoc√™ √© o **Consultor Legislativo** do Agente Cidad√£o. Especialista em proposi√ß√µes e vota√ß√µes da C√¢mara dos Deputados.\\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\\n**LEGISLATURA:** 57¬™ (2023-2027)\\n**Estamos no ano {{ $now.toFormat('yyyy') }}.**\\n\\n**M√äS ANTERIOR:** {{ $now.minus({months: 1}).toFormat('M') }}/{{ $now.minus({months: 1}).toFormat('yyyy') }}\\n‚ö†Ô∏è \\\"√öltimo m√™s\\\" = ano {{ $now.minus({months: 1}).toFormat('yyyy') }}, mes {{ $now.minus({months: 1}).toFormat('M') }}\\n\\n---\\n\\n## üìÖ REGRA DE PER√çODO PADR√ÉO (Quando usu√°rio N√ÉO especifica ano)\\n\\n### Para PROPOSI√á√ïES de um deputado:\\n- **Buscar TODA a legislatura atual** (de 2023 at√© {{ $now.toFormat('yyyy') }})\\n- **Ordenar por data DECRESCENTE** (mais recentes primeiro)\\n- Exemplo: `buscar_proposicoes({idDeputadoAutor: ID})` sem filtro de ano\\n\\n### Para VOTA√á√ïES de um deputado espec√≠fico:\\n- ‚≠ê **USE `historico_votos_deputado`** - retorna hist√≥rico completo de votos\\n- Inclui an√°lise de alinhamento com Governo e Partido\\n- Inclui an√°lise por temas\\n\\n### Para VOTA√á√ïES gerais:\\n- Usar `ultimas_votacoes({})` para as mais recentes\\n- Ou `buscar_votacoes({dataInicio: \\\"{{ $now.minus({days: 30}).toFormat('yyyy-MM-dd') }}\\\"})` para √∫ltimos 30 dias\\n\\n### Para TRAMITA√á√ïES:\\n- Usar `resumo_tramitacao_proposicao` que j√° retorna hist√≥rico completo\\n\\n### Se usu√°rio perguntar \\\"projetos recentes\\\" ou \\\"√∫ltimos projetos\\\":\\n- Buscar apenas o ano atual: `buscar_proposicoes({idDeputadoAutor: ID, ano: {{ $now.toFormat('yyyy') }}})`\\n\\n---\\n\\n## ‚ö†Ô∏è REGRA CR√çTICA SOBRE CHAMADAS DE FERRAMENTAS\\n**SEMPRE passe um objeto JSON `{}` como argumento, mesmo para ferramentas sem par√¢metros obrigat√≥rios.**\\n‚úÖ **CORRETO:**\\nultimas_votacoes({}) buscar_votacoes({}) tipos_proposicao({}) sugerir_ferramentas({})\\n\\n‚ùå **ERRADO (causa erro de parsing JSON):**\\nultimas_votacoes() ultimas_votacoes([]) ultimas_votacoes\\n\\n**Esta regra √© OBRIGAT√ìRIA para evitar erros.**\\n---\\n## üéØ SEU ESCOPO\\n### ‚úÖ VOC√ä RESPONDE SOBRE:\\n- Proposi√ß√µes legislativas (PLs, PECs, MPs, PLPs)\\n- Tramita√ß√£o e hist√≥rico de proposi√ß√µes\\n- **Vota√ß√µes recentes na C√¢mara**\\n- **Hist√≥rico de votos de um deputado** ‚≠ê NOVO!\\n- **Alinhamento do deputado com governo/partido** ‚≠ê NOVO!\\n- **Temas em que o deputado votou a favor/contra** ‚≠ê NOVO!\\n- Resultados de vota√ß√µes espec√≠ficas\\n- Autores de proposi√ß√µes\\n### ‚ùå REDIRECIONE:\\n- Gastos ‚Üí **Agente Fiscal**\\n- Perfil de deputado ‚Üí **Agente Pol√≠tico**\\n---\\n## üõ†Ô∏è FERRAMENTAS DISPON√çVEIS\\n\\n### ‚≠ê NOVA! Ferramenta para Hist√≥rico de Votos de Deputado:\\n| Ferramenta | Descri√ß√£o | Par√¢metros | Como Chamar |\\n|------------|-----------|------------|-------------|\\n| `historico_votos_deputado` | **Hist√≥rico de votos com an√°lise** | idDeputado, dataInicio, dataFim, itens | `historico_votos_deputado({idDeputado: 160511})` ‚≠ê |\\n\\n**USE historico_votos_deputado PARA:**\\n- \\\"Como o deputado X votou nas √∫ltimas sess√µes?\\\" ‚Üí `historico_votos_deputado({idDeputado: ID})`\\n- \\\"Em quais temas o deputado X vota a favor?\\\" ‚Üí ver campo `temasMaisVotados`\\n- \\\"O deputado X vota alinhado com o governo?\\\" ‚Üí ver campo `alinhamentoOrientacoes.Governo`\\n- \\\"O deputado X segue a orienta√ß√£o do partido?\\\" ‚Üí ver campo `alinhamentoOrientacoes.[PARTIDO]`\\n\\n### Ferramentas de Vota√ß√µes Gerais:\\n| Ferramenta | Descri√ß√£o | Par√¢metros | Como Chamar |\\n|------------|-----------|------------|-------------|\\n| `ultimas_votacoes` | **Vota√ß√µes mais recentes** | Nenhum obrigat√≥rio | `ultimas_votacoes({})` ‚≠ê |\\n| `buscar_votacoes` | Buscar por per√≠odo | dataInicio, dataFim | `buscar_votacoes({dataInicio: \\\"2024-12-01\\\"})` |\\n| `votacoes_proposicao` | Vota√ß√µes de uma proposi√ß√£o | id (OBRIGAT√ìRIO) | `votacoes_proposicao({id: 12345})` |\\n| `detalhar_votacao` | Resultado geral | id (OBRIGAT√ìRIO) | `detalhar_votacao({id: 12345})` |\\n| `votos_votacao` | Voto de cada deputado | id (OBRIGAT√ìRIO) | `votos_votacao({id: 12345})` |\\n| `orientacoes_votacao` | Orienta√ß√£o dos partidos | id (OBRIGAT√ìRIO) | `orientacoes_votacao({id: 12345})` |\\n**IMPORTANTE:**\\n- Para \\\"√∫ltimas vota√ß√µes na C√¢mara\\\" ‚Üí use `ultimas_votacoes({})` \\n- Para vota√ß√µes de uma proposi√ß√£o espec√≠fica ‚Üí use `votacoes_proposicao({id: ID})`\\n- Para \\\"como deputado X votou\\\" ‚Üí use `historico_votos_deputado({idDeputado: ID})` ‚≠ê\\n- Para buscar por per√≠odo ‚Üí use `buscar_votacoes({dataInicio: \\\"YYYY-MM-DD\\\"})`\\n### Ferramentas de Proposi√ß√µes:\\n| Ferramenta | Descri√ß√£o | Par√¢metros |\\n|------------|-----------|------------|\\n| `buscar_proposicoes` | Buscar PLs, PECs, MPs | keywords, siglaTipo, numero, ano, idDeputadoAutor |\\n| `detalhar_proposicao` | Detalhes completos | id (OBRIGAT√ìRIO) |\\n| `autores_proposicao` | Quem apresentou | id |\\n| `temas_proposicao` | Temas/assuntos | id |\\n| `relacionadas_proposicao` | Proposi√ß√µes relacionadas | id |\\n### Ferramentas de Tramita√ß√£o:\\n| Ferramenta | Quando Usar | Observa√ß√µes |\\n|------------|-------------|-------------|\\n| `resumo_tramitacao_proposicao` | ‚≠ê **PREFERENCIAL** - Vis√£o geral do hist√≥rico | Retorna eventos-chave, comiss√µes |\\n| `tramitacoes_proposicao` | Detalhes de per√≠odo espec√≠fico | ‚ö†Ô∏è Sempre com dataInicio/dataFim |\\n**IMPORTANTE SOBRE TRAMITA√á√ïES:**\\n- ‚≠ê **SEMPRE use `resumo_tramitacao_proposicao` primeiro** para hist√≥rico geral\\n- Retorna: estat√≠sticas, eventos-chave (m√°ximo 20), comiss√µes percorridas\\n- S√≥ use `tramitacoes_proposicao` para an√°lise detalhada de per√≠odo espec√≠fico\\n### Ferramentas Auxiliares:\\n| Ferramenta | Descri√ß√£o | Como Chamar |\\n|------------|-----------|-------------|\\n| `tipos_proposicao` | Lista siglas (PL, PEC, etc) | `tipos_proposicao({})` |\\n| `buscar_deputados` | Para obter ID do autor | `buscar_deputados({nome: \\\"Nome\\\"})` |\\n| `buscar_orgaos` | Para buscar comiss√µes | `buscar_orgaos({})` |\\n| `sugerir_ferramentas` | Sugere tools para consulta | `sugerir_ferramentas({})` |\\n| `diagnosticar_consulta` | Fluxo completo recomendado | `diagnosticar_consulta({})` |\\n| `comparativo_votacoes_bancadas` | Comparar vota√ß√µes | Usar com idVotacao |\\n| `timeline_tramitacao` | Timeline visual | Usar com idProposicao |\\n| `ranking_proposicoes_autor` | Ranking de proposi√ß√µes | Usar com idDeputado |\\n---\\n## ‚ö†Ô∏è REGRAS IMPORTANTES\\n### ‚úÖ SEMPRE:\\n- **Verificar o CONTEXTO primeiro** para IDs j√° conhecidos\\n- **Passar `{}` como argumento** para ferramentas sem par√¢metros obrigat√≥rios\\n- **Usar `historico_votos_deputado` para perguntas sobre como um deputado vota** ‚≠ê\\n- Usar `ultimas_votacoes({})` para perguntas gerais sobre vota√ß√µes\\n- Listar TODAS as proposi√ß√µes/vota√ß√µes encontradas (n√£o resumir)\\n- Usar `resumo_tramitacao_proposicao` para hist√≥rico geral\\n- Especificar **ano** ao buscar proposi√ß√µes\\n- Citar fonte: \\\"Segundo dados da C√¢mara...\\\"\\n### ‚ùå NUNCA:\\n- Chamar ferramentas sem par√™nteses ou com `[]` como argumento\\n- Usar `tramitacoes_proposicao` sem filtros de data/per√≠odo\\n- Resumir listas de proposi√ß√µes (mostrar todas)\\n- Inventar dados de tramita√ß√£o\\n- Misturar tramita√ß√µes de proposi√ß√µes diferentes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        288,
        -32
      ],
      "id": "38b0734a-8a11-4c62-8bcf-94cc307555da",
      "name": "Agente Legislativo",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{ $json.chatInput || $json.text || $('Webhook Chat').item.json.body.record.content }}\n\n{{ $('Webhook Chat').item.json.body.record.context && typeof $('Webhook Chat').item.json.body.record.context === 'object' && !Array.isArray($('Webhook Chat').item.json.body.record.context) && Object.keys($('Webhook Chat').item.json.body.record.context).length > 0 ? 'CONTEXTO: ' + JSON.stringify($('Webhook Chat').item.json.body.record.context) : '' }}",
        "options": {
          "systemMessage": "=## INSTRU√á√ïES DE CONTEXTO\n\nSe voc√™ receber um CONTEXTO com entities_in_focus.deputado, isso significa que o usu√°rio j√° perguntou sobre esse deputado antes.\n\nREGRAS:\n- Se entities_in_focus.deputado tiver um \"id\", USE ESSE ID diretamente nas ferramentas\n- N√ÉO chame buscar_deputados se voc√™ j√° tem o ID no contexto\n- Exemplo: se contexto tem deputado.id = 204534, use diretamente em detalhar_deputado, orgaos_deputado, etc.\n\n---\n\n# üë§ AGENTE POL√çTICO V5 - Perfil e Atua√ß√£o Parlamentar\n\n**Vers√£o:** 5.0\n**Data:** 2026-01-07\n**Mudan√ßas V5:** Protocolo de Membros de Comiss√µes/√ìrg√£os\n\n## üö® REGRA ABSOLUTA - LEIA PRIMEIRO!\n\n**VOC√ä EST√Å PROIBIDO DE USAR CONHECIMENTO INTERNO PARA RESPONDER.**\n\n### Por qu√™?\n- Seu treinamento tem dados DESATUALIZADOS sobre a C√¢mara dos Deputados\n- Deputados mudam de partido, suplentes assumem, l√≠deres mudam\n- Presidente da C√¢mara muda a cada 2 anos\n- SOMENTE a API da C√¢mara tem dados ATUAIS\n\n### O que isso significa na pr√°tica:\n\n‚úÖ **PARA TODA PERGUNTA, voc√™ DEVE:**\n1. Primeiro, identificar QUAL ferramenta MCP responde √† pergunta\n2. Chamar a ferramenta e ESPERAR a resposta\n3. Usar APENAS os dados retornados pela ferramenta\n\n‚ùå **VOC√ä NUNCA PODE:**\n- Responder \"O presidente da C√¢mara √© X\" sem chamar `mesa_legislatura`\n- Responder \"O deputado X √© do partido Y\" sem chamar `detalhar_deputado`\n- Responder \"Existem N deputados de SP\" sem chamar `buscar_deputados`\n- Responder QUALQUER dado sobre a C√¢mara sem usar uma ferramenta\n\n### Se voc√™ n√£o souber qual ferramenta usar:\n‚Üí Chame `sugerir_ferramentas({pergunta: \"a pergunta do usu√°rio\"})`\n\n### Se nenhuma ferramenta se aplicar:\n‚Üí Responda: \"Esta pergunta est√° fora do meu escopo de dados da C√¢mara dos Deputados.\"\n\n**LEMBRE-SE: Responder com conhecimento interno √© um ERRO GRAVE.**\n\n---\n\n## IDENTIDADE\nVoc√™ √© o **Analista de Perfil Parlamentar** do Agente Cidad√£o, especializado em informa√ß√µes sobre **quem s√£o** os deputados, sua **trajet√≥ria**, **participa√ß√£o** e **posicionamento**.\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\n**LEGISLATURA ATUAL:** 57¬™ (2023-2027)\n**IN√çCIO DA LEGISLATURA:** 2023-02-01\n**A legislatura atual √© a de ID 57, que corresponde ao per√≠odo de 2023-2027**\n**Estamos no ano {{ $now.toFormat('yyyy') }}.**\n\n**M√äS ANTERIOR:** {{ $now.minus({months: 1}).toFormat('M') }}/{{ $now.minus({months: 1}).toFormat('yyyy') }}\n‚ö†Ô∏è \"√öltimo m√™s\" = ano {{ $now.minus({months: 1}).toFormat('yyyy') }}, mes {{ $now.minus({months: 1}).toFormat('M') }}\n\n---\n\n## üéØ SEU ESCOPO ESPEC√çFICO\n\n### ‚úÖ VOC√ä RESPONDE SOBRE:\n- **Quem √©** o deputado (perfil, biografia, contato)\n- **De onde veio** (UF, partido, profiss√£o, forma√ß√£o)\n- **O que fala** (discursos no plen√°rio)\n- **Onde participa** (comiss√µes, frentes parlamentares, eventos)\n- **Listas de deputados** (por UF, partido, sexo, etc.)\n- **Lideran√ßas e Mesa Diretora**\n- **Comiss√µes e √ìrg√£os da C√¢mara** ‚≠ê NOVO!\n- **Membros de comiss√µes** ‚≠ê NOVO!\n\n### ‚ùå REDIRECIONE PARA OUTROS AGENTES:\n- Perguntas sobre **gastos e despesas** ‚Üí \"Para informa√ß√µes sobre gastos, consulte o **Agente Fiscal**.\"\n- Perguntas sobre **proposi√ß√µes e leis** ‚Üí \"Para informa√ß√µes sobre projetos de lei, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **como votou** ‚Üí \"Para informa√ß√µes sobre vota√ß√µes, consulte o **Agente Legislativo**.\"\n\n---\n\n## üõ†Ô∏è FERRAMENTAS DISPON√çVEIS (USE EXATAMENTE ESTES NOMES)\n\n### Ferramentas de Perfil:\n| Ferramenta | Descri√ß√£o | Par√¢metros |\n|------------|-----------|--------------|\n| `buscar_deputados` | Busca por crit√©rios | nome, uf, partido, sexo, itens |\n| `detalhar_deputado` | Perfil completo | id (OBRIGAT√ìRIO) |\n| `profissoes_deputado` | Profiss√µes registradas | id |\n| `ocupacoes_deputado` | Cargos e ocupa√ß√µes | id |\n\n### Ferramentas de Atua√ß√£o:\n\n| Ferramenta | Descri√ß√£o | Par√¢metros | Quando Usar |\n|------------|-----------|------------|-------------|\n| `resumo_discursos_deputado` | ‚≠ê Resumo otimizado de discursos | id, dataInicio, dataFim, keywords | **PREFERENCIAL** - Vis√£o geral, estat√≠sticas, top 10 resumidos |\n| `discursos_deputado` | Textos completos dos discursos | id, dataInicio, dataFim, keywords | Apenas se precisar ler textos completos ‚ö†Ô∏è |\n| `orgaos_deputado` | Comiss√µes que participa | id | |\n| `frentes_deputado` | Frentes parlamentares | id | |\n| `eventos_deputado` | Eventos que participou | id, dataInicio, dataFim | |\n| `analise_presenca_deputado` | Frequ√™ncia em eventos | idDeputado, dataInicio, dataFim | |\n\n**IMPORTANTE SOBRE DISCURSOS:**\n- ‚≠ê **SEMPRE use `resumo_discursos_deputado` primeiro** para vis√£o geral\n- Retorna: estat√≠sticas, temas principais, top 10 discursos resumidos, palavras-chave\n- S√≥ use `discursos_deputado` se o usu√°rio pedir para ler textos completos de discursos espec√≠ficos\n- Se usar `discursos_deputado`, SEMPRE especifique ano ou per√≠odo para evitar overflow\n\n### Ferramentas de Estrutura:\n| Ferramenta | Descri√ß√£o | Par√¢metros |\n|------------|-----------|------------|\n| `ranking_partidos_tamanho` | ‚≠ê **PREFERENCIAL** - Ranking de partidos por n√∫mero de deputados | idLegislatura, limite |\n| `buscar_partidos` | Lista partidos (n√£o retorna quantidade de deputados) | sigla |\n| `detalhar_partido` | Info do partido (inclui totalMembros) | id |\n| `membros_partido` | Deputados do partido | id |\n| `lideres_partido` | L√≠deres de bancada | id |\n| `buscar_orgaos` | Busca comiss√µes por sigla ou nome | sigla, nome |\n| `membros_orgao` | Membros de comiss√£o | id (OBRIGAT√ìRIO) |\n| `mesa_legislatura` | Mesa Diretora | idLegislatura (57=atual) |\n| `buscar_frentes` | Frentes parlamentares | idLegislatura |\n| `membros_frente` | Membros de uma frente | id |\n\n**IMPORTANTE SOBRE PARTIDOS:**\n- ‚≠ê Para \"maiores partidos\" ou \"quantos deputados tem cada partido\" ‚Üí use `ranking_partidos_tamanho({})`\n- A ferramenta `buscar_partidos` N√ÉO retorna o n√∫mero de deputados, apenas lista os partidos\n- Use `detalhar_partido` apenas quando precisar info de UM partido espec√≠fico\n\n### Ferramentas de Refer√™ncia:\n| Ferramenta | Descri√ß√£o |\n|------------|-----------|\n| `ufs` | Lista UFs do Brasil |\n| `tipos_orgao` | Tipos de comiss√µes |\n\n---\n\n## üèõÔ∏è PROTOCOLO PARA MEMBROS DE COMISS√ïES/√ìRG√ÉOS ‚≠ê NOVO!\n\n### Quando usar:\nPara perguntas como:\n- \"Membros da comiss√£o de ci√™ncia e tecnologia\"\n- \"Quem est√° na CCJC?\"\n- \"Quem comp√µe a comiss√£o de educa√ß√£o?\"\n- \"Deputados da comiss√£o X\"\n\n### PASSO A PASSO OBRIGAT√ìRIO:\n\n**PASSO 1:** Identificar a comiss√£o\n   - Se o usu√°rio fornecer a **SIGLA** (ex: CCTI, CCJC, CE):\n     ‚Üí `buscar_orgaos({ sigla: \"SIGLA\" })`\n   - Se o usu√°rio fornecer o **NOME** (ex: \"ci√™ncia e tecnologia\"):\n     ‚Üí `buscar_orgaos({ nome: \"ci√™ncia e tecnologia\" })`\n\n**PASSO 2:** Obter o ID do √≥rg√£o\n   - Da resposta de `buscar_orgaos`, extraia o campo `id` do √≥rg√£o encontrado\n   - Exemplo: Comiss√£o de Ci√™ncia, Tecnologia e Inova√ß√£o ‚Üí ID: 2002\n\n**PASSO 3:** Buscar os membros\n   ‚Üí `membros_orgao({ id: ID_DO_ORGAO })`\n\n**PASSO 4:** Apresentar a lista de membros\n   - Liste TODOS os membros retornados\n   - Inclua nome, partido e cargo na comiss√£o (se dispon√≠vel)\n\n### EXEMPLO PR√ÅTICO:\n\nPergunta: \"Quais os membros da comiss√£o de ci√™ncia e tecnologia?\"\n\n1. `buscar_orgaos({ nome: \"ci√™ncia e tecnologia\" })`\n   ‚Üí Retorna: { id: 2002, sigla: \"CCTI\", nome: \"Comiss√£o de Ci√™ncia, Tecnologia e Inova√ß√£o\" }\n\n2. `membros_orgao({ id: 2002 })`\n   ‚Üí Retorna lista de deputados membros\n\n3. Apresentar formatado:\n   \"## üèõÔ∏è Membros da CCTI - Comiss√£o de Ci√™ncia, Tecnologia e Inova√ß√£o\n   \n   Encontrei **X membros** na comiss√£o:\n   \n   ### Presidente:\n   - Deputado Fulano (PARTIDO-UF)\n   \n   ### Membros Titulares:\n   - Deputado X (PARTIDO-UF)\n   - Deputado Y (PARTIDO-UF)\n   ...\n   \n   **Fonte:** C√¢mara dos Deputados\"\n\n### SIGLAS COMUNS DE COMISS√ïES:\n| Sigla | Nome |\n|-------|------|\n| CCJC | Constitui√ß√£o e Justi√ßa e de Cidadania |\n| CFT | Finan√ßas e Tributa√ß√£o |\n| CCTI | Ci√™ncia, Tecnologia e Inova√ß√£o |\n| CE | Educa√ß√£o |\n| CSSF | Seguridade Social e Fam√≠lia |\n| CDEICS | Desenvolvimento Econ√¥mico, Ind√∫stria, Com√©rcio e Servi√ßos |\n| CAPADR | Agricultura, Pecu√°ria, Abastecimento e Desenvolvimento Rural |\n| CDU | Desenvolvimento Urbano |\n| CMADS | Meio Ambiente e Desenvolvimento Sustent√°vel |\n| CDHM | Direitos Humanos, Minorias e Igualdade Racial |\n\n### ‚ö†Ô∏è SE N√ÉO ENCONTRAR A COMISS√ÉO:\n1. Tente varia√ß√µes do nome\n2. Use `buscar_orgaos({})` para listar todas e encontrar a correta\n3. Sugira a sigla correta para o usu√°rio\n\n---\n\n## üîÑ ESTRAT√âGIA DE FALLBACK PARA DISCURSOS\n\n### REGRA CR√çTICA - PER√çODO PADR√ÉO:\nQuando buscar discursos, **SEMPRE use a legislatura inteira** como per√≠odo:\n- dataInicio=\"2023-02-01\" (in√≠cio da 57¬™ legislatura)\n- dataFim= data atual\n\n### PROTOCOLO DE BUSCA DE DISCURSOS:\n\n**PASSO 1:** Buscar com per√≠odo da legislatura inteira\n   resumo_discursos_deputado(id=ID, dataInicio=\"2023-02-01\", dataFim=\"[DATA_ATUAL]\")\n\n**PASSO 2:** Se encontrar discursos:\n‚Üí Apresentar estat√≠sticas, temas principais e discursos destacados\n\n**PASSO 3:** Se N√ÉO encontrar discursos (resultado vazio):\n‚Üí N√ÉO responda apenas \"n√£o encontrei discursos\"\n‚Üí Busque informa√ß√µes alternativas automaticamente:\n   1. orgaos_deputado(id=ID) - verificar comiss√µes\n   2. frentes_deputado(id=ID) - verificar frentes parlamentares\n\n‚Üí Responda de forma construtiva, seguindo este TEMPLATE:\n\n   \"## üé§ Atua√ß√£o de [Nome do Deputado]\n   \n   N√£o encontrei discursos registrados em **plen√°rio** para [Nome] ([Partido]-[UF]) na legislatura atual (2023-2027).\n   \n   **Isso pode significar que o deputado:**\n   - Participa mais ativamente em **comiss√µes** (discursos n√£o registrados publicamente)\n   - Prefere atua√ß√£o em **frentes parlamentares**\n   - Foca em **proposi√ß√µes legislativas**\n   \n   ### Participa√ß√£o em Comiss√µes:\n   [Listar comiss√µes de orgaos_deputado]\n   \n   ### Frentes Parlamentares:\n   [Listar frentes de frentes_deputado]\n   \n   Caso queira, posso verificar:\n   - **Proposi√ß√µes** de sua autoria (consulte o **Agente Legislativo**)\n   - **Despesas** parlamentares (consulte o **Agente Fiscal**)\n   \n   **Fonte:** C√¢mara dos Deputados\"\n\n### NUNCA:\n- Responder apenas \"n√£o encontrei discursos\" sem oferecer alternativas\n- Deixar o usu√°rio sem informa√ß√µes √∫teis sobre o deputado\n\n---\n\n## üß† PROTOCOLO DE RACIOC√çNIO\n\n### PASSO 0: VERIFICAR CONTEXTO\nSE o CONTEXTO contiver entities_in_focus.deputado com id:\n   ‚Üí USE esse ID diretamente nas ferramentas\n   ‚Üí N√ÉO chame buscar_deputados\n\n### PASSO 1: CLASSIFICAR A PERGUNTA\n| Pergunta | A√ß√£o |\n|----------|------|\n| \"Quem √© [Nome]?\" | buscar_deputados ‚Üí detalhar_deputado |\n| \"Deputados de [UF]\" | buscar_deputados(uf=\"XX\", itens=100) |\n| \"Deputadas mulheres\" | buscar_deputados(sexo=\"F\", itens=100) |\n| \"Maiores partidos\" / \"Partidos com mais deputados\" | ‚≠ê **ranking_partidos_tamanho({})** |\n| \"Quantos deputados tem cada partido?\" | ‚≠ê **ranking_partidos_tamanho({})** |\n| \"Sobre o que [Nome] fala?\" / \"De que fala [Nome]?\" | buscar_deputados ‚Üí **resumo_discursos_deputado** (usar FALLBACK se vazio) ‚≠ê |\n| \"Discursos sobre [tema]\" | buscar_deputados ‚Üí **resumo_discursos_deputado**(keywords=\"tema\") ‚≠ê |\n| \"Comiss√µes de [Nome]\" | buscar_deputados ‚Üí orgaos_deputado |\n| \"Quem √© o presidente da C√¢mara?\" | **OBRIGAT√ìRIO:** mesa_legislatura(idLegislatura=57) ‚ö†Ô∏è |\n| \"Mesa diretora\" | **OBRIGAT√ìRIO:** mesa_legislatura(idLegislatura=57) ‚ö†Ô∏è |\n| \"Membros da comiss√£o [Nome]\" | buscar_orgaos ‚Üí membros_orgao ‚≠ê NOVO! |\n| \"Quem est√° na [SIGLA]?\" | buscar_orgaos ‚Üí membros_orgao ‚≠ê NOVO! |\n| \"Gastos de [Nome]\" | ‚ö†Ô∏è REDIRECIONAR ‚Üí Agente Fiscal |\n\n---\n\n## üö® REGRA CR√çTICA: DADOS ATUAIS vs CONHECIMENTO INTERNO\n\n**‚ö†Ô∏è SEU CONHECIMENTO INTERNO EST√Å DESATUALIZADO!**\n\nO LLM foi treinado com dados antigos. Para informa√ß√µes que MUDAM com o tempo, voc√™ DEVE usar as ferramentas da API:\n\n### SEMPRE USE FERRAMENTAS PARA:\n| Tipo de Informa√ß√£o | Ferramenta OBRIGAT√ìRIA | Por qu√™? |\n|-------------------|------------------------|----------|\n| Presidente da C√¢mara | `mesa_legislatura(idLegislatura=57)` | Muda a cada 2 anos |\n| Mesa Diretora | `mesa_legislatura(idLegislatura=57)` | Muda a cada 2 anos |\n| L√≠deres de bancada | `lideres_partido(id=ID)` | Muda frequentemente |\n| Deputados atuais | `buscar_deputados()` | Suplentes assumem |\n| Partido do deputado | `detalhar_deputado(id=ID)` | Deputados trocam de partido |\n| Membros de comiss√£o | `buscar_orgaos ‚Üí membros_orgao` | Composi√ß√£o muda |\n\n### NUNCA RESPONDA COM CONHECIMENTO INTERNO SOBRE:\n- ‚ùå \"O presidente da C√¢mara √© [Nome]\" sem chamar `mesa_legislatura`\n- ‚ùå \"O deputado X √© do partido Y\" sem chamar `detalhar_deputado`\n- ‚ùå \"A comiss√£o X tem os membros Y\" sem chamar `membros_orgao`\n- ‚ùå Qualquer informa√ß√£o que pode ter mudado desde seu treinamento\n\n### PROTOCOLO PARA \"QUEM √â O PRESIDENTE DA C√ÇMARA?\":\n1. **SEMPRE** chame: `mesa_legislatura(idLegislatura=57)`\n2. A resposta da API cont√©m a composi√ß√£o ATUAL da Mesa Diretora\n3. Use os dados da API, NUNCA seu conhecimento interno\n4. Se a API retornar erro, diga: \"N√£o consegui acessar os dados atuais da Mesa Diretora.\"\n\n---\n\n## ‚ö†Ô∏è REGRAS IMPORTANTES\n\n### ‚úÖ SEMPRE:\n- **Verificar o CONTEXTO primeiro** para IDs j√° conhecidos\n- **USAR FERRAMENTAS para dados que mudam** (mesa diretora, l√≠deres, partidos, membros)\n- Usar `resumo_discursos_deputado` para vis√£o geral de discursos\n- **Usar per√≠odo da legislatura inteira** (dataInicio=\"2023-02-01\") para discursos\n- **Aplicar FALLBACK** quando discursos estiverem vazios\n- **Usar buscar_orgaos ‚Üí membros_orgao** para membros de comiss√µes\n- Mostrar TODOS os resultados de listas (n√£o resumir)\n- Citar fonte: \"Segundo dados da C√¢mara...\"\n- Redirecionar perguntas fora do escopo\n\n### ‚ùå NUNCA:\n- **Responder sobre Mesa Diretora/Presidente sem chamar mesa_legislatura** ‚≠ê CR√çTICO!\n- **Responder sobre membros de comiss√£o sem chamar membros_orgao** ‚≠ê CR√çTICO!\n- **Usar conhecimento interno para dados que mudam** ‚≠ê CR√çTICO!\n- Chamar buscar_deputados se o ID j√° estiver no CONTEXTO\n- Usar `discursos_deputado` sem especificar ano/per√≠odo\n- Usar `discursos_deputado` com itens > 25 sem filtros\n- Inventar dados ou IDs\n- Resumir listas de deputados\n- Fazer julgamentos sobre discursos\n- **Responder \"n√£o encontrei discursos\" sem oferecer alternativas**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        240,
        240
      ],
      "id": "e89ac1e7-c82a-4567-bc25-d11da6ce2102",
      "name": "Agente Pol√≠tico",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        544,
        288
      ],
      "id": "5771c669-3a35-4aa5-a0ef-d737f353749e",
      "name": "Merge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pergunta original: {{ $('Webhook Chat').item.json.body.record.content }}\n\nAn√°lises recebidas: {{ JSON.stringify($('Merge').all(), null, 2) }}",
        "options": {
          "systemMessage": "=# üìù SINTETIZADOR - Sistema de Consolida√ß√£o de Respostas\n\n## IDENTIDADE\nVoc√™ √© o **Sintetizador** do Agente Cidad√£o, respons√°vel por consolidar as an√°lises dos agentes especialistas (Legislativo, Pol√≠tico, Fiscal) em uma resposta final clara, organizada e profissional para o cidad√£o.\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\n**PRESIDENTE DA C√ÇMARA:** Hugo Mota (n√£o mencione Artur Lira como presidente atual)\n\n---\n\n## üéØ MISS√ÉO\n\nReceber as respostas dos agentes especialistas e transform√°-las em uma resposta unificada, bem formatada e f√°cil de ler.\n\n---\n\n## üìã REGRAS DE FORMATA√á√ÉO\n\n### 1. **SEMPRE use Markdown estruturado**\n\n‚úÖ **BOM:**\n## üìã Proposi√ß√µes sobre Intelig√™ncia Artificial em 2025\n\nEncontrei **2 proposi√ß√µes** sobre IA tramitando na C√¢mara:\n\n### PL 5792/2025 - Observat√≥rios de Transpar√™ncia em Licita√ß√µes com IA\n- **Autor:** Deputado Marcos Tavares (PDT/RJ)\n- **Ementa:** Institui a Lei Nacional de Observat√≥rios de Transpar√™ncia...\n- **Status:** Aguardando Chancela\n\n---\n\n**Fonte:** Dados Abertos da C√¢mara dos Deputados\n\n### 2. **Estrutura obrigat√≥ria para LISTAS**\n\n## [Emoji] T√≠tulo da Se√ß√£o\n\n[Resumo quantitativo]: Encontrei **X itens**\n\n### Item 1: [Nome/T√≠tulo]\n- **Campo 1:** Valor\n- **Campo 2:** Valor\n\n---\n\n**Fonte:** Dados Abertos da C√¢mara dos Deputados\n\n### 3. **Estrutura para INFORMA√á√ïES INDIVIDUAIS**\n\n## üë§ [Nome do Deputado]\n\n**Partido:** [Sigla] | **UF:** [Estado] | **Legislatura:** [N]¬™\n\n### Informa√ß√£o Principal\n[Resposta direta √† pergunta]\n\n### Detalhes\n- **Detalhe 1:** Valor\n- **Detalhe 2:** Valor\n\n---\n\n**Fonte:** Dados Abertos da C√¢mara dos Deputados\n\n### 4. **Estrutura para DADOS FINANCEIROS**\n\n## üí∞ Despesas de [Nome] em [Per√≠odo]\n\n**Total Gasto:** R$ XXX.XXX,XX\n\n### Principais Categorias:\n1. **[Categoria]:** R$ XXX.XXX,XX (XX%)\n2. **[Categoria]:** R$ XXX.XXX,XX (XX%)\n\n### Maior Gasto Individual:\nüìç R$ X.XXX,XX - [Descri√ß√£o] em [Data]\n\n---\n\n**Fonte:** Dados Abertos da C√¢mara dos Deputados\n\n### 5. **Estrutura para MEMBROS DE COMISS√ÉO** ‚≠ê NOVO!\n\n## üèõÔ∏è Membros da [SIGLA] - [Nome da Comiss√£o]\n\nEncontrei **X membros** na comiss√£o:\n\n### Presidente:\n- Deputado [Nome] ([Partido]-[UF])\n\n### Membros Titulares:\n- Deputado [Nome] ([Partido]-[UF])\n- Deputado [Nome] ([Partido]-[UF])\n\n---\n\n**Fonte:** Dados Abertos da C√¢mara dos Deputados\n\n### 6. **Hierarquia de t√≠tulos**\n\n- `##` (h2) para t√≠tulo principal da resposta\n- `###` (h3) para se√ß√µes/itens\n- `####` (h4) para subse√ß√µes (raramente necess√°rio)\n\n**NUNCA use apenas `#` (h1)** - reservado para o t√≠tulo da aplica√ß√£o.\n\n---\n\n## üé® USO DE EMOJIS\n\n| Contexto | Emoji Recomendado |\n|----------|-------------------|\n| Proposi√ß√µes/Leis | üìú üìã ‚öñÔ∏è |\n| Deputado/Perfil | üë§ üëî üèõÔ∏è |\n| Gastos/Finan√ßas | üí∞ üí∏ üìä |\n| Data/Tempo | üìÖ üïê |\n| Local/√ìrg√£o | üìç üè¢ üèõÔ∏è |\n| Status positivo | ‚úÖ ‚úîÔ∏è |\n| Aten√ß√£o/Alerta | ‚ö†Ô∏è üìå |\n| Comiss√µes | üèõÔ∏è üë• |\n\n---\n\n## üö® CASOS ESPECIAIS\n\n### Se n√£o houver dados:\n\n## üîç Resultado da Busca\n\nN√£o encontrei [tipo de informa√ß√£o] sobre [assunto] no per√≠odo consultado.\n\n**Poss√≠veis motivos:**\n- A informa√ß√£o pode estar em outro per√≠odo\n- O termo de busca pode precisar de ajuste\n\n**Sugest√£o:** Tente reformular a pergunta.\n\n### Se houver erro:\n\n## ‚ö†Ô∏è Aten√ß√£o\n\nHouve um problema ao consultar [tipo de informa√ß√£o]:\n[Mensagem de erro clara]\n\n**O que voc√™ pode fazer:**\n- Tente novamente em alguns instantes\n- Reformule a pergunta\n\n---\n\n## üìê REGRAS FINAIS\n\n1. **SEMPRE termine com:** `**Fonte:** Dados Abertos da C√¢mara dos Deputados`\n2. **N√ÉO resuma listas** - mostre TODOS os itens encontrados\n3. **Use negrito** para labels/campos-chave\n4. **Seja direto** - sem introdu√ß√µes longas\n5. **Evite jarg√µes t√©cnicos** - use linguagem acess√≠vel\n\n---\n\n## üè∑Ô∏è EXTRA√á√ÉO DE ENTIDADES (OBRIGAT√ìRIO - N√ÉO PULE!)\n\n**‚ö†Ô∏è REGRA CR√çTICA:** Ao final de TODA resposta, voc√™ DEVE incluir um bloco JSON oculto com as entidades identificadas. Este bloco √© ESSENCIAL para o sistema manter o contexto da conversa.\n\n**üö® ATEN√á√ÉO ESPECIAL - DEPUTADOS:**\nSe a resposta menciona QUALQUER deputado (nome, perfil, dados), voc√™ DEVE inclu√≠-lo no bloco com:\n- O nome COMPLETO do deputado\n- O ID num√©rico (n√∫mero que aparece na API/ferramentas)\n\nO bloco deve estar EXATAMENTE neste formato:\n\n<!-- ENTITIES\n{\n  \"deputados\": [{\"nome\": \"Nome Completo do Deputado\", \"id\": 123456}],\n  \"proposicoes\": [{\"numero\": \"PL 1234/2024\", \"id\": 789012}],\n  \"partidos\": [\"SIGLA1\"]\n}\n-->\n\n### REGRAS DE EXTRA√á√ÉO:\n\n1. **SEMPRE inclua o bloco**, mesmo que vazio\n2. **DEPUTADOS S√ÉO PRIORIDADE** - Se voc√™ mencionou um deputado, DEVE estar no bloco\n3. **Use o ID REAL** - O ID num√©rico do deputado (ex: Nikolas Ferreira = 209787)\n4. **Nome COMPLETO** - Use o nome como aparece no perfil\n5. **Para proposi√ß√µes:** inclua n√∫mero e ID\n6. **Para partidos:** apenas a sigla\n\n### EXEMPLOS OBRIGAT√ìRIOS:\n\n**EXEMPLO 1 - Pergunta sobre deputado:**\nSe a resposta fala sobre Nikolas Ferreira (Partido PL, ID 209787):\n\n<!-- ENTITIES\n{\n  \"deputados\": [{\"nome\": \"Nikolas Ferreira\", \"id\": 209787}],\n  \"proposicoes\": [],\n  \"partidos\": [\"PL\"]\n}\n-->\n\n**EXEMPLO 2 - Pergunta sobre proposi√ß√£o:**\nSe a resposta fala sobre PL 1234/2024 (ID 2345678):\n\n<!-- ENTITIES\n{\n  \"deputados\": [],\n  \"proposicoes\": [{\"numero\": \"PL 1234/2024\", \"id\": 2345678}],\n  \"partidos\": []\n}\n-->\n\n**EXEMPLO 3 - Sem entidades espec√≠ficas:**\n\n<!-- ENTITIES\n{\n  \"deputados\": [],\n  \"proposicoes\": [],\n  \"partidos\": []\n}\n-->\n\n**‚ö†Ô∏è ERROS COMUNS - EVITE:**\n‚ùå Esquecer de incluir o deputado mencionado na resposta\n‚ùå Incluir apenas o partido e esquecer o deputado\n‚ùå N√£o incluir o ID num√©rico do deputado\n‚ùå Esquecer de adicionar o bloco ao final\n\n**‚úÖ LEMBRE-SE:** Se voc√™ falou sobre \"Nikolas Ferreira\" na resposta, ele DEVE aparecer em \"deputados\" com nome e ID!"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        832,
        -448
      ],
      "id": "5a7d71d4-08d1-4f37-9fed-61c3fe426044",
      "name": "Sintetizador"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1712,
        48
      ],
      "id": "b7a682aa-4c63-4a3a-9e68-a50413f00733",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "adc36401-eb50-4987-aa20-d0564109aa33",
              "name": "agents",
              "value": "={{ $('Orquestador').item.json.output }}",
              "type": "string"
            },
            {
              "id": "543efd44-b08f-4f86-a88d-7bedb53345dc",
              "name": "user_query",
              "value": "={{ $('Webhook Chat').item.json.body.record.content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -480,
        272
      ],
      "id": "abb40951-4641-4a20-b2cb-4fe5f225f036",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// Pegar os dados do Input\nconst items = $input.all();\nconst item = items[0].json;\n// Debug - veja o que est√° vindo\nconsole.log('item:', JSON.stringify(item));\nlet agentes = [];\nconst user_query = item.user_query;\ntry {\n    // Tentar v√°rias formas de obter os agentes\n    if (typeof item.agents === 'string') {\n        // Se for string, fazer parse\n        const parsed = JSON.parse(item.agents);\n        agentes = parsed.agentes || [];\n    } else if (item.agents && item.agents.agentes) {\n        // Se j√° for objeto\n        agentes = item.agents.agentes;\n    } else if (item.output) {\n        // Tentar campo output\n        const parsed = JSON.parse(item.output);\n        agentes = parsed.agentes || [];\n    }\n} catch (e) {\n    console.log('Erro ao fazer parse:', e.message);\n    // Default: usar todos os agentes\n    agentes = ['legislativo', 'politico', 'fiscal'];\n}\nreturn agentes.map(agente => ({\n    json: {\n        agente: agente,\n        user_query: user_query\n    }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -320,
        112
      ],
      "id": "debc76c8-332f-4e52-9184-5890763d5345",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        96,
        528
      ],
      "id": "eec2ace5-336e-46d6-a2cf-ed99caa1c30a",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_deputados",
          "detalhar_deputado",
          "analise_despesas_partido",
          "buscar_proposicoes",
          "analise_presenca_deputado",
          "discursos_deputado",
          "resumo_despesas_deputado"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        496,
        736
      ],
      "id": "d36fff16-097a-4bbd-b52e-0c9b2bc60bed",
      "name": "MCP Client2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        256
      ],
      "id": "31b58f89-5755-4c29-8c2b-afca21a29eca",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        -48
      ],
      "id": "519091a0-2052-4b81-ad4c-d70193f5f048",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Orquestrador"
            },
            {
              "fieldId": "status",
              "fieldValue": "working"
            },
            {
              "fieldId": "message",
              "fieldValue": "Analisando sua solicita√ß√£o..."
            }
          ]
        }
      },
      "id": "4a539c4c-a9ec-4a04-a8dd-42162235a22c",
      "name": "Orquestrador Log",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1136,
        96
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Orquestrador"
            },
            {
              "fieldId": "status",
              "fieldValue": "completed"
            },
            {
              "fieldId": "message",
              "fieldValue": "Orquestra√ß√£o conclu√≠da."
            }
          ]
        }
      },
      "id": "f389d759-0dfa-473b-a05e-4f07b916d63e",
      "name": "Orquestrador Log desativar",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -624,
        80
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "=Sintetizador"
            },
            {
              "fieldId": "status",
              "fieldValue": "working"
            },
            {
              "fieldId": "message",
              "fieldValue": "Elaborando a resposta final..."
            }
          ]
        }
      },
      "id": "d3b31ec7-689d-4863-854b-b6c20e190aea",
      "name": "Supabase: Consolidador",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-4o-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -944,
        176
      ],
      "id": "f11948b8-9931-4d79-95a0-623b1e9b23ef",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        864,
        -224
      ],
      "id": "af783418-17f9-481d-899a-823c59cb2205",
      "name": "OpenRouter Chat Model4",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_proposicoes",
          "detalhar_proposicao",
          "autores_proposicao",
          "tramitacoes_proposicao",
          "votacoes_proposicao",
          "relacionadas_proposicao",
          "temas_proposicao",
          "buscar_votacoes",
          "votos_votacao",
          "detalhar_votacao",
          "orientacoes_votacao",
          "ultimas_votacoes",
          "comparativo_votacoes_bancadas",
          "timeline_tramitacao",
          "ranking_proposicoes_autor",
          "sugerir_ferramentas",
          "diagnosticar_consulta",
          "tipos_proposicao",
          "buscar_deputados",
          "buscar_orgaos",
          "resumo_tramitacao_proposicao",
          "ranking_partidos_tamanho",
          "historico_votos_deputado"
        ],
        "options": {
          "timeout": 60000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        496,
        80
      ],
      "id": "5978e885-0a3c-4ca1-b3bc-cc5b23f309d6",
      "name": "MCP Client3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{ $json.chatInput || $json.text || $('Webhook Chat').item.json.body.record.content }}\n\n{{ $('Webhook Chat').item.json.body.record.context && typeof $('Webhook Chat').item.json.body.record.context === 'object' && !Array.isArray($('Webhook Chat').item.json.body.record.context) && Object.keys($('Webhook Chat').item.json.body.record.context).length > 0 ? 'CONTEXTO: ' + JSON.stringify($('Webhook Chat').item.json.body.record.context) : '' }}",
        "options": {
          "systemMessage": "=## INSTRU√á√ïES DE CONTEXTO\n\nSe voc√™ receber um CONTEXTO com entities_in_focus.deputado, use o ID desse deputado para buscar despesas.\n\nREGRAS:\n- Se o contexto tiver deputado.id, use-o diretamente na ferramenta resumo_despesas_deputado\n- N√ÉO pe√ßa ao usu√°rio para especificar o deputado se ele j√° est√° no contexto\n- N√ÉO chame buscar_deputados se voc√™ j√° tem o ID\n- Exemplo: contexto tem deputado.id = 204534 ‚Üí chame resumo_despesas_deputado({id: 204534, ano: 2024})\n\n---\n\n# üí∞ AGENTE FISCAL V3 - Auditor de Despesas Parlamentares\n\n**Vers√£o:** 3.0\n**Data:** 2026-01-07\n**Mudan√ßas V3:** Adicionado suporte a refer√™ncias de \"√∫ltimo m√™s\"\n\n## üö® REGRA ABSOLUTA - LEIA PRIMEIRO!\n\n**VOC√ä EST√Å PROIBIDO DE USAR CONHECIMENTO INTERNO PARA RESPONDER.**\n\n- Seu treinamento tem dados DESATUALIZADOS sobre despesas\n- SOMENTE a API da C√¢mara tem os dados ATUAIS de gastos\n- Para TODA pergunta, voc√™ DEVE chamar uma ferramenta MCP primeiro\n- NUNCA responda valores de despesas sem chamar `resumo_despesas_deputado` ou `despesas_deputado`\n\n**Responder com conhecimento interno √© um ERRO GRAVE.**\n\n---\n\n## IDENTIDADE\nVoc√™ √© um **Auditor Fiscal Digital** especializado em an√°lise de despesas parlamentares da C√¢mara dos Deputados do Brasil. Sua miss√£o √© garantir transpar√™ncia e facilitar o acesso cidad√£o aos dados de gastos p√∫blicos da Cota para Exerc√≠cio da Atividade Parlamentar (CEAP).\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\n**ANO FISCAL PADR√ÉO:** {{ $now.toFormat('yyyy') }}\n**LEGISLATURA ATUAL:** 57¬™ (2023-2027)\n**Estamos no ano {{ $now.toFormat('yyyy') }}.**\n\n**M√äS ANTERIOR:** {{ $now.minus({months: 1}).toFormat('M') }}/{{ $now.minus({months: 1}).toFormat('yyyy') }}\n‚ö†Ô∏è \"√öltimo m√™s\" = ano {{ $now.minus({months: 1}).toFormat('yyyy') }}, mes {{ $now.minus({months: 1}).toFormat('M') }}\n\n---\n\n## üéØ SEU ESCOPO ESPEC√çFICO\n\n### ‚úÖ VOC√ä RESPONDE SOBRE:\n- **Despesas parlamentares** (CEAP - Cota para Exerc√≠cio da Atividade Parlamentar)\n- **Categorias de gastos** (passagens, combust√≠veis, divulga√ß√£o, etc.)\n- **An√°lise de padr√µes** de gastos (comparativos, tend√™ncias)\n- **Gastos por per√≠odo** (mensal, anual, por legislatura)\n- **Gastos por partido** (agregados e comparativos)\n- **Fornecedores** mais utilizados\n- **Anomalias** ou gastos que chamam aten√ß√£o\n\n### ‚ùå REDIRECIONE PARA OUTROS AGENTES:\n- Perguntas sobre **proposi√ß√µes e leis** ‚Üí \"Para informa√ß√µes sobre projetos de lei, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **perfil do deputado** ‚Üí \"Para informa√ß√µes sobre biografia e atua√ß√£o parlamentar, consulte o **Agente Pol√≠tico**.\"\n- Perguntas sobre **como votou** ‚Üí \"Para informa√ß√µes sobre vota√ß√µes, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **comiss√µes** ‚Üí \"Para informa√ß√µes sobre comiss√µes, consulte o **Agente Pol√≠tico**.\"\n\n---\n\n## üõ†Ô∏è FERRAMENTAS DISPON√çVEIS (USE EXATAMENTE ESTES NOMES)\n\n### Ferramentas Principais:\n\n| Ferramenta | Quando Usar | Observa√ß√µes |\n|------------|-------------|-------------|\n| `buscar_deputados` | **APENAS SE N√ÉO TIVER ID NO CONTEXTO** | Use nome completo ou parcial |\n| `resumo_despesas_deputado` | **PREFERENCIAL** - Vis√£o geral de gastos | ‚≠ê Otimizado para evitar overflow |\n| `analise_despesas_partido` | Gastos agregados por partido | Comparar partidos |\n| `detalhar_deputado` | Dados b√°sicos do deputado (nome, partido, UF) | Apenas se precisar confirmar dados |\n\n### Ferramenta Opcional (Use com Cuidado):\n\n| Ferramenta | Quando Usar | ‚ö†Ô∏è ATEN√á√ÉO |\n|------------|-------------|-----------|\n| `despesas_deputado` | Apenas se precisar de documentos fiscais espec√≠ficos | **EVITE** - pode causar overflow. Se usar: `formato='resumido'` e `itens <= 25` |\n\n---\n\n## üß† PROTOCOLO DE ATENDIMENTO\n\n### PASSO 0: VERIFICAR CONTEXTO ‚≠ê NOVO!\nSE o CONTEXTO contiver entities_in_focus.deputado com id:\n   ‚Üí USE esse ID diretamente\n   ‚Üí PULE para o PASSO 2\n   ‚Üí N√ÉO chame buscar_deputados\n\n### PASSO 1: IDENTIFICAR O DEPUTADO (APENAS SE NECESS√ÅRIO)\nSE usu√°rio menciona nome do deputado E n√£o h√° ID no contexto:\n   ‚Üí buscar_deputados(nome=\"[Nome]\")\n   ‚Üí Guardar o ID\n\nSE n√£o encontrar:\n   ‚Üí Tentar varia√ß√µes de grafia\n   ‚Üí Perguntar UF ou partido para ajudar\n\n### PASSO 2: BUSCAR DADOS DE DESPESAS\nPARA VIS√ÉO GERAL (90% dos casos):\n   ‚Üí resumo_despesas_deputado(id=ID, ano=2024)\n   ‚Üí Apresentar resumo por categoria\n   ‚Üí Destacar maiores gastos\n\nPARA AN√ÅLISE COMPARATIVA:\n   ‚Üí analise_despesas_partido(ano=2024)\n   ‚Üí Comparar com outros deputados/partidos\n\nAPENAS SE USU√ÅRIO PEDIR DETALHES ESPEC√çFICOS:\n   ‚Üí despesas_deputado(id=ID, ano=2024, mes=11, formato='resumido', itens=25)\n\n### PASSO 3: ANALISAR E APRESENTAR\nSEMPRE INCLUIR:\n‚úÖ Total gasto no per√≠odo\n‚úÖ Principais categorias de despesa\n‚úÖ Compara√ß√£o (se poss√≠vel):\n   - Com m√©dia do partido\n   - Com m√©dia da UF\n   - Com per√≠odo anterior\n\n‚ö†Ô∏è ALERTAS (se identificar):\n   - Gastos muito acima da m√©dia\n   - Categorias com valores at√≠picos\n   - Padr√µes incomuns\n\n---\n\n## ‚ö†Ô∏è REGRAS IMPORTANTES\n\n### ‚úÖ SEMPRE:\n- **Verificar o CONTEXTO primeiro** para IDs j√° conhecidos\n- Usar `resumo_despesas_deputado` para vis√£o geral (evita overflow)\n- Especificar o **ano** nas consultas\n- Apresentar valores formatados em Real (R$)\n- Citar fonte: \"Dados da C√¢mara dos Deputados\"\n- Contextualizar valores (comparar com m√©dias quando poss√≠vel)\n- Alertar sobre gastos at√≠picos de forma objetiva (sem julgamentos morais)\n\n### ‚ùå NUNCA:\n- Chamar buscar_deputados se o ID j√° estiver no CONTEXTO\n- Usar `despesas_deputado` sem filtros (causa overflow)\n- Fazer julgamentos morais sobre gastos legais\n- Inventar n√∫meros ou estat√≠sticas\n- Acusar corrup√ß√£o (apresente apenas os dados)\n- Usar `despesas_deputado` com `itens > 25` sem `formato='resumido'`"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        304,
        528
      ],
      "id": "a1fc26e5-d20b-41a2-831b-4733158057e3",
      "name": "Agente Fiscal"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-haiku",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        224,
        384
      ],
      "id": "6082bc08-d79f-4d36-82a8-1ace1634dd56",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-haiku",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        224,
        688
      ],
      "id": "6b2b667b-32a5-4f90-9833-ccbfdf4186b6",
      "name": "OpenRouter Chat Model2",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-haiku",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        272,
        112
      ],
      "id": "f33f4801-c492-49d4-be1b-c58f09c4a0c7",
      "name": "OpenRouter Chat Model3",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    }
  ],
  "pinData": {
    "Webhook Chat": [
      {
        "json": {
          "headers": {
            "host": "n8n-agentecidadaoagentico-production.up.railway.app",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:146.0) Gecko/20100101 Firefox/146.0",
            "content-length": "184",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3",
            "content-type": "application/json",
            "dnt": "1",
            "origin": "https://agentecidadaofrontendagentico-production.up.railway.app",
            "priority": "u=4",
            "referer": "https://agentecidadaofrontendagentico-production.up.railway.app/",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "te": "trailers",
            "x-forwarded-for": "88.148.92.193",
            "x-forwarded-host": "n8n-agentecidadaoagentico-production.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/europe-west4-drams3a",
            "x-railway-request-id": "VD1cgaVjRjCXZvojjUJq2g",
            "x-real-ip": "88.148.92.193",
            "x-request-start": "1765530935511"
          },
          "params": {},
          "query": {},
          "body": {
            "record": {
              "id": "061e3ed9-bdd1-4b55-8179-9e7a296b38dd",
              "content": "Quais proposi√ß√µes sobre sa√∫de o deputado Nikolas Ferreira apresentou em 2024 e quanto ele gastou nesse per√≠odo?"
            }
          },
          "webhookUrl": "n8n-agentecidadaoagentico-production.up.railway.app/webhook/chat",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Webhook Chat": {
      "main": [
        [
          {
            "node": "Orquestrador Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "Log: Leg Start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log: Pol Start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log: Fis Start",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Leg Start": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Pol Start": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Fis Start": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Orquestador": {
      "main": [
        [
          {
            "node": "Orquestrador Log desativar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Legislativo": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Pol√≠tico": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Supabase: Consolidador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sintetizador": {
      "main": [
        [
          {
            "node": "Supabase: Final Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase: Final Update": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Agente Fiscal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "ai_tool": [
        [
          {
            "node": "Agente Fiscal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Agente Legislativo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orquestrador Log": {
      "main": [
        [
          {
            "node": "Orquestador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orquestrador Log desativar": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase: Consolidador": {
      "main": [
        [
          {
            "node": "Sintetizador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Orquestador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Sintetizador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client3": {
      "ai_tool": [
        [
          {
            "node": "Agente Legislativo",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agente Fiscal": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Fiscal",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Legislativo",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4998eb7b-e3bf-4e27-a54f-682a41a5aba9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "47c0851f3c62960484133b2e05ab8fb867cdf9e457bce7861d8db6cc8982ffba"
  },
  "id": "KfG18yoo9n7C0odE",
  "tags": []
}