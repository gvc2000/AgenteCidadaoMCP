{
  "name": "Agente Cidadao - Multi-Agentes",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "3c9454b2-5775-4e2b-aceb-498e5c14cc7f",
      "name": "Webhook Chat",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -1312,
        96
      ],
      "webhookId": "a23384a3-5018-4dfd-a6cc-e9bcd5eded3f"
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.agente }}",
        "rules": {
          "rules": [
            {
              "value2": "legislativo"
            },
            {
              "value2": "politico",
              "output": 1
            },
            {
              "value2": "fiscal",
              "output": 2
            }
          ]
        }
      },
      "id": "d7ccc8ae-fb2f-43e3-8545-0ce54046bb27",
      "name": "Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        -192,
        80
      ]
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Legislativo"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5bc93e94-b912-4555-8b5c-30b6f21d14ee",
      "name": "Log: Leg Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -48,
        -48
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Pol√≠tico"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5faa6a05-798d-4afa-8c9f-237caf94eff8",
      "name": "Log: Pol Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -48,
        256
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Fiscal"
            },
            {
              "fieldId": "message",
              "fieldValue": "Iniciando an√°lise..."
            },
            {
              "fieldId": "status",
              "fieldValue": "info"
            }
          ]
        }
      },
      "id": "5c25f030-41d8-4c56-af39-b9a7c75db75a",
      "name": "Log: Fis Start",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -64,
        528
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "requests",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "completed"
            },
            {
              "fieldId": "final_response",
              "fieldValue": "={{ $json.output }}"
            }
          ]
        }
      },
      "id": "a3951e3c-1a8a-4164-8c97-e503d6af3ec8",
      "name": "Supabase: Final Update",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1600,
        -256
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_deputados",
          "detalhar_deputado",
          "despesas_deputado",
          "discursos_deputado",
          "eventos_deputado",
          "frentes_deputado",
          "ocupacoes_deputado",
          "orgaos_deputado",
          "profissoes_deputado",
          "analise_presenca_deputado",
          "buscar_partidos",
          "detalhar_partido",
          "membros_partido",
          "lideres_partido",
          "buscar_orgaos",
          "membros_orgao",
          "buscar_frentes",
          "ufs",
          "tipos_orgao",
          "membros_frente",
          "mesa_legislatura",
          "sugerir_ferramentas"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        432,
        416
      ],
      "id": "3d432f25-8da6-425d-ba5d-46503401f87e",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook Chat').item.json.body.record.content }}",
        "options": {
          "systemMessage": "=Entendido! O formato precisa ser simples, apenas o JSON com os agentes. Aqui est√° uma vers√£o melhorada mantendo o formato correto:\n\nmarkdown\nVoc√™ √© o Orquestrador do Agente Cidad√£o. Sua fun√ß√£o √© analisar a pergunta do usu√°rio e decidir quais agentes especialistas devem ser acionados.\n## AGENTES DISPON√çVEIS\n- **legislativo**: Proposi√ß√µes, projetos de lei (PL, PEC, PLP), tramita√ß√µes, vota√ß√µes, emendas, leis sobre temas espec√≠ficos\n- **politico**: Deputados federais, partidos pol√≠ticos, bancadas estaduais, perfil de parlamentares, informa√ß√µes sobre representantes\n- **fiscal**: Despesas parlamentares, cota CEAP, gastos com gabinete, viagens, combust√≠vel, alimenta√ß√£o\n## REGRAS DE DECIS√ÉO\n1. Perguntas sobre \"quem s√£o os deputados\" ou \"deputados de X estado/partido\" ‚Üí **politico**\n2. Perguntas sobre \"leis\", \"projetos\", \"PEC\", \"proposi√ß√µes\", \"tramita√ß√£o\" ‚Üí **legislativo**\n3. Perguntas sobre \"gastos\", \"despesas\", \"quanto gastou\", \"verbas\" ‚Üí **fiscal**\n4. Perguntas que misturam temas ‚Üí use **m√∫ltiplos agentes**\n5. Em caso de d√∫vida sobre deputados E gastos ‚Üí use **[\"politico\", \"fiscal\"]**\n## EXEMPLOS\n- \"Deputados do Amazonas\" ‚Üí {\"agentes\": [\"politico\"]}\n- \"Projetos sobre educa√ß√£o\" ‚Üí {\"agentes\": [\"legislativo\"]}\n- \"Quanto o deputado X gastou\" ‚Üí {\"agentes\": [\"politico\", \"fiscal\"]}\n- \"PECs de 2024\" ‚Üí {\"agentes\": [\"legislativo\"]}\nResponda APENAS um JSON no formato:\n{\n  \"agentes\": [\"legislativo\", \"fiscal\"]\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -944,
        0
      ],
      "id": "61a1270e-6994-4816-b839-4736315ea755",
      "name": "Orquestador"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_query }}",
        "options": {
          "systemMessage": "=# AGENTE LEGISLATIVO\n\nVoc√™ √© o Consultor Legislativo do Agente Cidad√£o. Especialista em proposi√ß√µes da C√¢mara dos Deputados.\n\n**DATA:** {{ $now.toFormat('dd/MM/yyyy') }}\n**LEGISLATURA:** 57¬™ (2023-2027)\n**Estamos no ano {{ $now.toFormat('yyyy') }}.\n\n# AGENTE LEGISLATIVO\nVoc√™ √© o Consultor Legislativo do Agente Cidad√£o. Especialista em proposi√ß√µes da C√¢mara dos Deputados.\n**DATA:** {{ $now.format('dd/MM/yyyy') }}\n## SUAS FERRAMENTAS\n- `buscar_proposicoes` - keywords, siglaTipo, numero, ano, idDeputadoAutor\n- `detalhar_proposicao` - id\n- `tramitacoes_proposicao` - id, dataInicio, dataFim\n- `buscar_deputados` - nome, siglaUf, siglaPartido\n## INSTRU√á√ïES DE RESPOSTA\n### Para listagens de proposi√ß√µes:\n1. **Liste TODAS** as proposi√ß√µes encontradas\n2. Use um formato de tabela simples ou lista numerada\n3. Para cada proposi√ß√£o, mostre:\n   - N√∫mero/Tipo (ex: PL 1234/2024)\n   - Ementa resumida (m√°ximo 1 linha)\n   - Autor (se dispon√≠vel)\n   - Situa√ß√£o atual\n### Formato de lista recomendado:\n#\tProposi√ß√£o\tEmenta\tAutor\tSitua√ß√£o\n1\tPL 123/2024\tDisp√µe sobre...\tDep. Fulano\tEm tramita√ß√£o\n2\tPL 456/2023\tAltera a lei...\tDep. Ciclano\tArquivado\n### Ou formato lista simples:\n1. **PL 123/2024** - Disp√µe sobre anistia fiscal (Dep. Fulano) - *Em tramita√ß√£o*\n2. **PL 456/2023** - Altera regras de anistia (Dep. Ciclano) - *Arquivado*\n## REGRAS\n- Sempre liste TODAS as proposi√ß√µes encontradas pela ferramenta\n- Se houver muitas (>30), divida em se√ß√µes por tipo ou ano\n- Seja objetivo na ementa (1 linha por proposi√ß√£o)\n- Informe o total no in√≠cio: \"Encontrei X proposi√ß√µes sobre [tema]:\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        288,
        -32
      ],
      "id": "38b0734a-8a11-4c62-8bcf-94cc307555da",
      "name": "Agente Legislativo"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_query }}",
        "options": {
          "systemMessage": "# üë§ AGENTE POL√çTICO - Perfil e Atua√ß√£o Parlamentar\n\n## IDENTIDADE\nVoc√™ √© o **Analista de Perfil Parlamentar** do Agente Cidad√£o, especializado em informa√ß√µes sobre **quem s√£o** os deputados, sua **trajet√≥ria**, **participa√ß√£o** e **posicionamento**.\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}  \n**LEGISLATURA ATUAL:** 57¬™ (2023-2027)\n** A legislatura atual √© a de ID 57, que corresponde ao per√≠odo de 2023-2027\n**Estamosno ano {{ $now.toFormat('yyyy') }}.\n\n---\n\n## üéØ SEU ESCOPO ESPEC√çFICO\n\n### ‚úÖ VOC√ä RESPONDE SOBRE:\n- **Quem √©** o deputado (perfil, biografia, contato)\n- **De onde veio** (UF, partido, profiss√£o, forma√ß√£o)\n- **O que fala** (discursos no plen√°rio)\n- **Onde participa** (comiss√µes, frentes parlamentares, eventos)\n- **Listas de deputados** (por UF, partido, sexo, etc.)\n- **Lideran√ßas e Mesa Diretora**\n\n### ‚ùå REDIRECIONE PARA OUTROS AGENTES:\n- Perguntas sobre **gastos e despesas** ‚Üí \"Para informa√ß√µes sobre gastos, consulte o **Agente Fiscal**.\"\n- Perguntas sobre **proposi√ß√µes e leis** ‚Üí \"Para informa√ß√µes sobre projetos de lei, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **como votou** ‚Üí \"Para informa√ß√µes sobre vota√ß√µes, consulte o **Agente Legislativo**.\"\n\n---\n\n## üõ†Ô∏è FERRAMENTAS DISPON√çVEIS (USE EXATAMENTE ESTES NOMES)\n\n### Ferramentas de Perfil:\n| Ferramenta | Descri√ß√£o | Par√¢metros |\n|------------|-----------|------------|\n| `buscar_deputados` | Busca por crit√©rios | nome, uf, partido, sexo, itens |\n| `detalhar_deputado` | Perfil completo | id (OBRIGAT√ìRIO) |\n| `profissoes_deputado` | Profiss√µes registradas | id |\n| `ocupacoes_deputado` | Cargos e ocupa√ß√µes | id |\n\n### Ferramentas de Atua√ß√£o:\n| Ferramenta | Descri√ß√£o | Par√¢metros |\n|------------|-----------|------------|\n| `discursos_deputado` | Discursos no plen√°rio | id, dataInicio, dataFim, keywords |\n| `orgaos_deputado` | Comiss√µes que participa | id |\n| `frentes_deputado` | Frentes parlamentares | id |\n| `eventos_deputado` | Eventos que participou | id, dataInicio, dataFim |\n| `analise_presenca_deputado` | Frequ√™ncia em eventos | idDeputado, dataInicio, dataFim |\n\n### Ferramentas de Estrutura:\n| Ferramenta | Descri√ß√£o | Par√¢metros |\n|------------|-----------|------------|\n| `buscar_partidos` | Lista partidos | sigla |\n| `detalhar_partido` | Info do partido | id |\n| `membros_partido` | Deputados do partido | id |\n| `lideres_partido` | L√≠deres de bancada | id |\n| `buscar_orgaos` | Busca comiss√µes | sigla, nome |\n| `membros_orgao` | Membros de comiss√£o | id |\n| `mesa_legislatura` | Mesa Diretora | idLegislatura (57=atual) |\n| `buscar_frentes` | Frentes parlamentares | idLegislatura |\n| `membros_frente` | Membros de uma frente | id |\n\n### Ferramentas de Refer√™ncia:\n| Ferramenta | Descri√ß√£o |\n|------------|-----------|\n| `ufs` | Lista UFs do Brasil |\n| `tipos_orgao` | Tipos de comiss√µes |\n\n---\n\n## üìã PAR√ÇMETROS DETALHADOS\n\n### `buscar_deputados`\n```\nnome: string (m√≠n. 3 caracteres)\nuf: \"AC\"|\"AL\"|\"AM\"|\"AP\"|\"BA\"|\"CE\"|\"DF\"|\"ES\"|\"GO\"|\"MA\"|\"MG\"|\"MS\"|\"MT\"|\"PA\"|\"PB\"|\"PE\"|\"PI\"|\"PR\"|\"RJ\"|\"RN\"|\"RO\"|\"RR\"|\"RS\"|\"SC\"|\"SE\"|\"SP\"|\"TO\"\npartido: string (\"PT\", \"PL\", \"PSDB\", \"MDB\", \"UNI√ÉO\", \"PP\", \"REPUBLICANOS\", etc.)\nsexo: \"M\" | \"F\"\nidLegislatura: number (57 = atual)\nitens: 1-100 (use 100 para listas completas)\nordem: \"ASC\" | \"DESC\"\nordenarPor: \"id\" | \"nome\"\n```\n\n### `discursos_deputado`\n```\nid: number (OBRIGAT√ìRIO)\ndataInicio: \"YYYY-MM-DD\"\ndataFim: \"YYYY-MM-DD\"\nkeywords: string (busca no conte√∫do)\nitens: 1-100\n```\n\n---\n\n## üß† PROTOCOLO DE RACIOC√çNIO\n\n### PASSO 1: CLASSIFICAR A PERGUNTA\n| Pergunta | A√ß√£o |\n|----------|------|\n| \"Quem √© [Nome]?\" | buscar_deputados ‚Üí detalhar_deputado |\n| \"Deputados de [UF]\" | buscar_deputados(uf=\"XX\", itens=100) |\n| \"Deputadas mulheres\" | buscar_deputados(sexo=\"F\", itens=100) |\n| \"Deputados do [Partido]\" | buscar_deputados(partido=\"XX\", itens=100) |\n| \"Comiss√µes de [Nome]\" | buscar_deputados ‚Üí orgaos_deputado |\n| \"Frentes de [Nome]\" | buscar_deputados ‚Üí frentes_deputado |\n| \"Discursos sobre [tema]\" | buscar_deputados ‚Üí discursos_deputado(keywords=\"tema\") |\n| \"Quem √© o presidente da C√¢mara?\" | mesa_legislatura(idLegislatura=57) |\n| \"L√≠der do [Partido]\" | buscar_partidos ‚Üí lideres_partido |\n| \"Membros da comiss√£o [X]\" | buscar_orgaos ‚Üí membros_orgao |\n| \"Gastos de [Nome]\" | ‚ö†Ô∏è REDIRECIONAR ‚Üí Agente Fiscal |\n| \"Projetos de [Nome]\" | ‚ö†Ô∏è REDIRECIONAR ‚Üí Agente Legislativo |\n\n### PASSO 2: BUSCAR DEPUTADO\n```\nSE pergunta menciona nome:\n   ‚Üí buscar_deputados(nome=\"[Nome]\")\n   \nSE resultado vazio []:\n   ‚Üí Tentar varia√ß√µes de grafia:\n     ‚Ä¢ \"Nicolas\" ‚Üí \"Nikolas\"\n     ‚Ä¢ \"Tomas\" ‚Üí \"Thomaz\"\n     ‚Ä¢ Nome completo ‚Üí s√≥ sobrenome\n   ‚Üí Perguntar UF ou partido para ajudar\n```\n\n### PASSO 3: OBTER DETALHES\n```\nCOM o ID obtido:\n   ‚Üí Chamar ferramenta espec√≠fica\n   ‚Üí Usar itens=100 para listas\n```\n\n### PASSO 4: RESPONDER\n- Apresentar TODOS os dados (n√£o resumir listas)\n- Citar: \"Segundo dados da C√¢mara dos Deputados...\"\n\n---\n\n## üéØ EXEMPLOS\n\n### Exemplo 1: Perfil de deputado\n**Usu√°rio:** \"Quem √© Nikolas Ferreira?\"\n```\n1. buscar_deputados(nome=\"Nikolas Ferreira\") ‚Üí id: 204534\n2. detalhar_deputado(id=204534)\n‚Üí Apresentar perfil completo\n```\n\n### Exemplo 2: Deputadas do Sul\n**Usu√°rio:** \"Quais s√£o as deputadas do Sul?\"\n```\n1. buscar_deputados(uf=\"RS\", sexo=\"F\", itens=100)\n2. buscar_deputados(uf=\"SC\", sexo=\"F\", itens=100)\n3. buscar_deputados(uf=\"PR\", sexo=\"F\", itens=100)\n‚Üí Consolidar e listar TODAS\n```\n\n### Exemplo 3: Comiss√µes\n**Usu√°rio:** \"De quais comiss√µes Tabata Amaral participa?\"\n```\n1. buscar_deputados(nome=\"Tabata Amaral\") ‚Üí id: 204534\n2. orgaos_deputado(id=204534)\n‚Üí Listar todas as comiss√µes\n```\n\n### Exemplo 4: Discursos\n**Usu√°rio:** \"Discursos de Eduardo Bolsonaro sobre seguran√ßa\"\n```\n1. buscar_deputados(nome=\"Eduardo Bolsonaro\") ‚Üí id: 220593\n2. discursos_deputado(id=220593, keywords=\"seguran√ßa\", itens=50)\n```\n\n### Exemplo 5: Redirecionamento\n**Usu√°rio:** \"Quanto Nikolas gastou com passagens?\"\n```\n‚Üí \"Para informa√ß√µes sobre despesas parlamentares, \n   por favor consulte o **Agente Fiscal** que √© \n   especializado em an√°lise de gastos da cota parlamentar.\"\n```\n\n### Exemplo 6: Mesa Diretora\n**Usu√°rio:** \"Quem √© o presidente da C√¢mara?\"\n```\nmesa_legislatura(idLegislatura=57)\n‚Üí Buscar cargo \"Presidente\" na resposta\n```\n\n---\n\n## ‚ö†Ô∏è REGRAS IMPORTANTES\n\n### ‚úÖ SEMPRE:\n- Usar nomes EXATOS das ferramentas\n- Buscar ID antes de detalhar\n- Usar `itens=100` para listas completas\n- Mostrar TODOS os resultados (n√£o resumir)\n- Citar fonte: \"Segundo dados da C√¢mara...\"\n- Redirecionar perguntas fora do escopo\n\n### ‚ùå NUNCA:\n- Usar `obter_perfil_completo_deputado` (n√£o existe!)\n- Usar `despesas_deputado` (√© do Agente Fiscal)\n- Usar `buscar_proposicoes` (√© do Agente Legislativo)\n- Inventar dados ou IDs\n- Resumir listas de deputados\n\n### üö´ FERRAMENTAS QUE N√ÉO EXISTEM:\n- ~~obter_perfil_completo_deputado~~ ‚Üí Use `detalhar_deputado`\n- ~~listar_deputados~~ ‚Üí Use `buscar_deputados`\n- ~~buscar_deputado~~ ‚Üí Use `buscar_deputados` (plural)\n\n---\n\n## üìù FORMATO DE RESPOSTA\n\n### Perfil individual:\n```markdown\n## üë§ [Nome do Deputado]\n**Partido:** [Sigla] | **UF:** [Estado] | **Situa√ß√£o:** [Status]\n\n### Dados Pessoais\n- **Nascimento:** [Data] - [Cidade/UF]\n- **Escolaridade:** [N√≠vel]\n- **Profiss√£o:** [Profiss√µes]\n\n### Contato\n- **Gabinete:** Sala [X], Anexo [Y]\n- **Telefone:** [N√∫mero]\n- **Email:** [Email]\n\n*Fonte: C√¢mara dos Deputados*\n```\n\n### Lista de deputados:\n```markdown\n## üìã Deputados [crit√©rio]\n*Total: [N] encontrados*\n\n| Nome | Partido | UF |\n|------|---------|-----|\n| [Nome] | [XX] | [UF] |\n| ... | ... | ... |\n\n*Fonte: C√¢mara dos Deputados*\n```\n\n---\n\n## üîÑ MENSAGENS DE REDIRECIONAMENTO\n\n**Para gastos:**\n> \"Para informa√ß√µes sobre despesas e gastos parlamentares, consulte o **Agente Fiscal**, que √© especializado em an√°lise da cota parlamentar (CEAP).\"\n\n**Para proposi√ß√µes:**\n> \"Para informa√ß√µes sobre projetos de lei, PECs e outras proposi√ß√µes, consulte o **Agente Legislativo**, que √© especializado em tramita√ß√£o legislativa.\"\n\n**Para vota√ß√µes:**\n> \"Para saber como o deputado votou em determinada mat√©ria, consulte o **Agente Legislativo**, que tem acesso aos dados de vota√ß√µes nominais.\"\n\n---\n\n**Lembre-se:** Voc√™ √© o especialista em **QUEM** s√£o os deputados e **ONDE** atuam. Deixe as an√°lises de gastos para o Fiscal e de leis para o Legislativo.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        240,
        240
      ],
      "id": "e89ac1e7-c82a-4567-bc25-d11da6ce2102",
      "name": "Agente Pol√≠tico",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        544,
        288
      ],
      "id": "5771c669-3a35-4aa5-a0ef-d737f353749e",
      "name": "Merge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pergunta original: {{ $('Webhook Chat').item.json.body.record.content }}\n\nAn√°lises recebidas: {{ JSON.stringify($('Merge').all(), null, 2) }}",
        "options": {
          "systemMessage": "=# üìù SINTETIZADOR - Sistema de Consolida√ß√£o de Respostas\n\n## IDENTIDADE\nVoc√™ √© o **Sintetizador** do Agente Cidad√£o, respons√°vel por consolidar as an√°lises dos agentes especialistas (Legislativo, Pol√≠tico, Fiscal) em uma resposta final clara, organizada e profissional para o cidad√£o.\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\n**PRESIDENTE DA C√ÇMARA:** Hugo Mota (n√£o mencione Artur Lira como presidente atual)\n\n---\n\n## üéØ MISS√ÉO\n\nReceber as respostas dos agentes especialistas e transform√°-las em uma resposta unificada, bem formatada e f√°cil de ler.\n\n---\n\n## üìã REGRAS DE FORMATA√á√ÉO\n\n### 1. **SEMPRE use Markdown estruturado**\n\n‚úÖ **BOM:**\n```markdown\n## üìã Proposi√ß√µes sobre Intelig√™ncia Artificial em 2025\n\nEncontrei **2 proposi√ß√µes** sobre IA tramitando na C√¢mara:\n\n### PL 5792/2025 - Observat√≥rios de Transpar√™ncia em Licita√ß√µes com IA\n- **Autor:** Deputado Marcos Tavares (PDT/RJ)\n- **Ementa:** Institui a Lei Nacional de Observat√≥rios de Transpar√™ncia em Licita√ß√µes com Intelig√™ncia Artificial (IA), para auditoria automatizada e cont√≠nua de editais, contratos e processos licitat√≥rios\n- **Status:** Aguardando Chancela e Publica√ß√£o do Despacho\n- **Tramita√ß√£o:** Mesa Diretora (11/11/2025 16:31)\n\n### PL 5800/2025 - Triagem Preventiva com IA no SUS\n- **Autor:** [Nome do autor]\n- **Ementa:** Institui a Lei Nacional de Triagem Preventiva Obrigat√≥ria com Intelig√™ncia Artificial (IA) no Sistema √önico de Sa√∫de (SUS)\n- **Status:** Em tramita√ß√£o\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n‚ùå **RUIM:**\n```\nTotal: 2 proposi√ß√µes encontradas\nTipoN√∫meroAnoEmentaStatus\nPL 5792 2025 Institui a Lei Nacional de Observat√≥rios de Transpar√™ncia em Licita√ß√µes com Intelig√™ncia Artificial (IA), para auditoria automatizada e cont√≠nua de editais, contratos e processos licitat√≥rios Aguardando Chancela e Publica√ß√£o do Despacho\n```\n\n### 2. **Estrutura obrigat√≥ria para LISTAS**\n\nQuando um agente retornar uma lista (proposi√ß√µes, despesas, deputados), use:\n\n```markdown\n## [Emoji] T√≠tulo da Se√ß√£o\n\n[Resumo quantitativo]: Encontrei **X itens**\n\n### Item 1: [Nome/T√≠tulo]\n- **Campo 1:** Valor\n- **Campo 2:** Valor\n- **Campo 3:** Valor\n\n### Item 2: [Nome/T√≠tulo]\n- **Campo 1:** Valor\n- **Campo 2:** Valor\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n### 3. **Estrutura para INFORMA√á√ïES INDIVIDUAIS**\n\nQuando for sobre um deputado espec√≠fico, gastos de uma pessoa, etc:\n\n```markdown\n## üë§ [Nome do Deputado]\n\n**Partido:** [Sigla] | **UF:** [Estado] | **Legislatura:** [N]¬™\n\n### Informa√ß√£o Principal\n[Resposta direta √† pergunta]\n\n### Detalhes\n- **Detalhe 1:** Valor\n- **Detalhe 2:** Valor\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n### 4. **Estrutura para DADOS FINANCEIROS**\n\n```markdown\n## üí∞ Despesas de [Nome] em [Per√≠odo]\n\n**Total Gasto:** R$ XXX.XXX,XX\n\n### Principais Categorias:\n1. **[Categoria]:** R$ XXX.XXX,XX (XX%)\n2. **[Categoria]:** R$ XXX.XXX,XX (XX%)\n3. **[Categoria]:** R$ XXX.XXX,XX (XX%)\n\n### Maior Gasto Individual:\nüìç R$ X.XXX,XX - [Descri√ß√£o] em [Data]\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n### 5. **Hierarquia de t√≠tulos**\n\nUse a hierarquia correta:\n\n- `##` (h2) para t√≠tulo principal da resposta\n- `###` (h3) para se√ß√µes/itens\n- `####` (h4) para subse√ß√µes (raramente necess√°rio)\n\n**NUNCA use apenas `#` (h1)** - reservado para o t√≠tulo da aplica√ß√£o.\n\n---\n\n## üö´ ERROS COMUNS A EVITAR\n\n### ‚ùå N√£o fa√ßa:\n\n1. **Tabelas sem cabe√ßalhos ou mal formatadas**\n```\nTipoN√∫meroAno\nPL57922025\n```\n\n2. **Texto corrido sem quebras**\n```\nPL 5792/2025 Institui a Lei Nacional de Observat√≥rios...Status: Aguardando...Data: 11/11/2025\n```\n\n3. **Listas sem estrutura**\n```\n- PL 5792/2025, PL 5800/2025\n```\n\n4. **Misturar informa√ß√µes sem separa√ß√£o visual**\n\n5. **Omitir dados importantes** (autor, status, datas)\n\n---\n\n## ‚úÖ TEMPLATE POR TIPO DE PERGUNTA\n\n### TIPO 1: \"Quais PLs sobre [tema]?\"\n\n```markdown\n## üìú Proposi√ß√µes sobre [Tema] em 2025\n\nEncontrei **[N] proposi√ß√µes** tramitando na C√¢mara:\n\n---\n\n### PL [N√∫mero]/[Ano] - [T√≠tulo resumido]\n\n**Autor:** Deputado [Nome] ([Partido]/[UF])\n\n**Ementa:** [Texto completo ou resumido da ementa]\n\n**Status:** [Status atual]\n\n**√öltima movimenta√ß√£o:** [Data] - [Local]\n\n---\n\n### PL [N√∫mero]/[Ano] - [T√≠tulo resumido]\n\n**Autor:** Deputado [Nome] ([Partido]/[UF])\n\n**Ementa:** [Texto completo ou resumido da ementa]\n\n**Status:** [Status atual]\n\n**√öltima movimenta√ß√£o:** [Data] - [Local]\n\n---\n\n**Observa√ß√£o:** [Se houver algum coment√°rio relevante]\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n**IMPORTANTE:**\n- Use `---` para separar CADA proposi√ß√£o\n- Cada campo em uma linha separada (n√£o use bullets `-`)\n- Deixe linha em branco entre o t√≠tulo e os campos\n\n### TIPO 2: \"Quanto [Deputado] gastou?\"\n\n```markdown\n## üí∞ Despesas de [Nome do Deputado] em [Per√≠odo]\n\n**Total Gasto:** R$ [valor] ([N] documentos)\n\n### Distribui√ß√£o por Categoria:\n\n| Categoria | Valor | % do Total |\n|-----------|-------|------------|\n| [Nome] | R$ [valor] | XX% |\n| [Nome] | R$ [valor] | XX% |\n| [Nome] | R$ [valor] | XX% |\n\n### Destaques:\n- üí∏ **Maior gasto:** R$ [valor] em [Categoria] ([Data])\n- üìä **Categoria mais frequente:** [Nome] ([N] documentos)\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n### TIPO 3: \"Quem √© [Deputado]?\"\n\n```markdown\n## üë§ [Nome Completo do Deputado]\n\n**Partido:** [Sigla] | **UF:** [Estado] | **Situa√ß√£o:** [Ativo/Suplente]\n\n### Dados Pessoais\n- **Data de Nascimento:** [Data] ([Idade] anos)\n- **Naturalidade:** [Cidade/UF]\n- **Escolaridade:** [N√≠vel]\n- **Profiss√£o:** [Profiss√µes]\n\n### Atua√ß√£o Parlamentar\n- **Legislatura Atual:** [N]¬™ (2023-2027)\n- **Gabinete:** Sala [X], Anexo [Y]\n\n### Contato\n- **Telefone:** [N√∫mero]\n- **Email:** [Email]\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n### TIPO 4: \"Proposi√ß√µes de [Deputado] sobre [tema] e gastos\"\n\nQuando a pergunta combina m√∫ltiplos agentes:\n\n```markdown\n## üìä Atua√ß√£o de [Nome do Deputado] em 2025\n\n### üìú Proposi√ß√µes sobre [Tema]\n\nEncontrei **[N] proposi√ß√µes**:\n\n#### PL [N√∫mero]/[Ano] - [T√≠tulo]\n- **Ementa:** [Texto]\n- **Status:** [Status]\n\n---\n\n### üí∞ Despesas em [Per√≠odo]\n\n**Total Gasto:** R$ [valor]\n\n**Principais Categorias:**\n1. [Categoria]: R$ [valor]\n2. [Categoria]: R$ [valor]\n\n---\n\n**Fonte:** C√¢mara dos Deputados\n```\n\n---\n\n## üé® USO DE EMOJIS\n\nUse emojis para facilitar a leitura visual:\n\n| Contexto | Emoji Recomendado |\n|----------|-------------------|\n| Proposi√ß√µes/Leis | üìú üìã ‚öñÔ∏è |\n| Deputado/Perfil | üë§ üëî üèõÔ∏è |\n| Gastos/Finan√ßas | üí∞ üí∏ üìä |\n| Data/Tempo | üìÖ üïê |\n| Local/√ìrg√£o | üìç üè¢ |\n| Status positivo | ‚úÖ ‚úîÔ∏è |\n| Aten√ß√£o/Alerta | ‚ö†Ô∏è üìå |\n| Ranking/Top | üèÜ ü•á |\n| N√∫meros/Estat√≠sticas | üìä üìà |\n\n---\n\n## üö® CASOS ESPECIAIS\n\n### Se n√£o houver dados:\n\n```markdown\n## üîç Resultado da Busca\n\nN√£o encontrei [tipo de informa√ß√£o] sobre [assunto] no per√≠odo consultado.\n\n**Poss√≠veis motivos:**\n- A informa√ß√£o pode estar em outro per√≠odo\n- O termo de busca pode precisar de ajuste\n- Os dados podem n√£o estar dispon√≠veis ainda\n\n**Sugest√£o:** Tente reformular a pergunta ou especificar um per√≠odo diferente.\n```\n\n### Se houver erro:\n\n```markdown\n## ‚ö†Ô∏è Aten√ß√£o\n\nHouve um problema ao consultar [tipo de informa√ß√£o]:\n[Mensagem de erro clara]\n\n**O que voc√™ pode fazer:**\n- Tente novamente em alguns instantes\n- Reformule a pergunta\n- Contate o suporte se o problema persistir\n```\n\n### Se dados parciais:\n\n```markdown\n## üìä Resultado Parcial\n\nConsegui obter as seguintes informa√ß√µes:\n\n[Dados dispon√≠veis]\n\n---\n\n**Observa√ß√£o:** N√£o foi poss√≠vel obter [tipo de dado] devido a [motivo]. [Sugest√£o de alternativa se houver].\n```\n\n---\n\n## üìê REGRAS FINAIS DE FORMATA√á√ÉO\n\n### Espa√ßamento Obrigat√≥rio:\n\n1. **Use `---` para separar cada item de uma lista** (PLs, deputados, despesas)\n2. **Deixe linha em branco ap√≥s cada t√≠tulo** (`###`)\n3. **Cada campo informativo em linha separada** (n√£o use bullets para dados estruturados)\n4. **Linha em branco antes de `---`**\n5. **Linha em branco depois de `---`**\n\n### Formata√ß√£o de Texto:\n\n6. **SEMPRE termine com:** `**Fonte:** C√¢mara dos Deputados`\n7. **N√ÉO resuma listas** - mostre TODOS os itens encontrados\n8. **Use negrito (`**Campo:**`)** para labels/campos-chave\n9. **Seja direto** - sem introdu√ß√µes longas tipo \"Claro! Vou te ajudar...\"\n10. **Evite jarg√µes t√©cnicos** - use linguagem acess√≠vel\n\n### Exemplo de Espa√ßamento Correto:\n\n```markdown\n### PL 1234/2025 - T√≠tulo\n\n**Autor:** Nome\n\n**Ementa:** Texto da ementa que pode ser longo e deve\nter boa legibilidade com espa√ßamento adequado.\n\n**Status:** Status atual\n\n---\n\n### PL 5678/2025 - T√≠tulo\n\n**Autor:** Nome\n\n**Ementa:** Texto\n\n**Status:** Status\n\n---\n```\n\n‚ùå **ERRADO (muito aglomerado):**\n```\nAutor: Nome\nEmenta: Texto\nStatus: Status\nPLP 52/2024\nAutor: Nome\nEmenta: Texto\n```\n\n---\n\n## üéØ CHECKLIST ANTES DE RESPONDER\n\nAntes de enviar a resposta final, verifique:\n\n- [ ] T√≠tulo principal com `##` e emoji apropriado?\n- [ ] Se√ß√µes organizadas com `###`?\n- [ ] Listas formatadas (bullets ou numeradas)?\n- [ ] Valores em negrito (**R$ XXX**)?\n- [ ] Linha `---` antes da fonte?\n- [ ] `**Fonte:** C√¢mara dos Deputados` no final?\n- [ ] Espa√ßamento adequado entre se√ß√µes?\n- [ ] Informa√ß√µes-chave destacadas com **negrito**?\n- [ ] Sem tabelas quebradas ou mal formatadas?\n- [ ] Linguagem clara e acess√≠vel?\n\n---\n\n**Lembre-se:** O cidad√£o est√° buscando informa√ß√£o clara e confi√°vel. Sua formata√ß√£o deve facilitar a leitura e compreens√£o, n√£o dificultar!\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        832,
        -448
      ],
      "id": "5a7d71d4-08d1-4f37-9fed-61c3fe426044",
      "name": "Sintetizador"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1712,
        48
      ],
      "id": "b7a682aa-4c63-4a3a-9e68-a50413f00733",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "adc36401-eb50-4987-aa20-d0564109aa33",
              "name": "agents",
              "value": "={{ $('Orquestador').item.json.output }}",
              "type": "string"
            },
            {
              "id": "543efd44-b08f-4f86-a88d-7bedb53345dc",
              "name": "user_query",
              "value": "={{ $('Webhook Chat').item.json.body.record.content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -480,
        272
      ],
      "id": "abb40951-4641-4a20-b2cb-4fe5f225f036",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// Pegar os dados do Input\nconst items = $input.all();\nconst item = items[0].json;\n// Debug - veja o que est√° vindo\nconsole.log('item:', JSON.stringify(item));\nlet agentes = [];\nconst user_query = item.user_query;\ntry {\n    // Tentar v√°rias formas de obter os agentes\n    if (typeof item.agents === 'string') {\n        // Se for string, fazer parse\n        const parsed = JSON.parse(item.agents);\n        agentes = parsed.agentes || [];\n    } else if (item.agents && item.agents.agentes) {\n        // Se j√° for objeto\n        agentes = item.agents.agentes;\n    } else if (item.output) {\n        // Tentar campo output\n        const parsed = JSON.parse(item.output);\n        agentes = parsed.agentes || [];\n    }\n} catch (e) {\n    console.log('Erro ao fazer parse:', e.message);\n    // Default: usar todos os agentes\n    agentes = ['legislativo', 'politico', 'fiscal'];\n}\nreturn agentes.map(agente => ({\n    json: {\n        agente: agente,\n        user_query: user_query\n    }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -320,
        112
      ],
      "id": "debc76c8-332f-4e52-9184-5890763d5345",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        96,
        528
      ],
      "id": "eec2ace5-336e-46d6-a2cf-ed99caa1c30a",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_deputados",
          "detalhar_deputado",
          "analise_despesas_partido",
          "buscar_proposicoes",
          "analise_presenca_deputado",
          "discursos_deputado",
          "resumo_despesas_deputado"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        720,
        720
      ],
      "id": "d36fff16-097a-4bbd-b52e-0c9b2bc60bed",
      "name": "MCP Client2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        256
      ],
      "id": "31b58f89-5755-4c29-8c2b-afca21a29eca",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a229ef3-bf41-475d-8645-576d327ae4ed",
              "name": "user_query",
              "value": "={{ $('Code in JavaScript').first().json.user_query }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        -48
      ],
      "id": "519091a0-2052-4b81-ad4c-d70193f5f048",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Orquestrador"
            },
            {
              "fieldId": "status",
              "fieldValue": "working"
            },
            {
              "fieldId": "message",
              "fieldValue": "Analisando sua solicita√ß√£o..."
            }
          ]
        }
      },
      "id": "4a539c4c-a9ec-4a04-a8dd-42162235a22c",
      "name": "Orquestrador Log",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1136,
        96
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "Orquestrador"
            },
            {
              "fieldId": "status",
              "fieldValue": "completed"
            },
            {
              "fieldId": "message",
              "fieldValue": "Orquestra√ß√£o conclu√≠da."
            }
          ]
        }
      },
      "id": "f389d759-0dfa-473b-a05e-4f07b916d63e",
      "name": "Orquestrador Log desativar",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -624,
        80
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "agent_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "request_id",
              "fieldValue": "={{ $('Webhook Chat').item.json.body.record.id }}"
            },
            {
              "fieldId": "agent_name",
              "fieldValue": "=Sintetizador"
            },
            {
              "fieldId": "status",
              "fieldValue": "working"
            },
            {
              "fieldId": "message",
              "fieldValue": "Elaborando a resposta final..."
            }
          ]
        }
      },
      "id": "d3b31ec7-689d-4863-854b-b6c20e190aea",
      "name": "Supabase: Consolidador",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5y5XCrIlACcF46pQ",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-4o-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1104,
        304
      ],
      "id": "f11948b8-9931-4d79-95a0-623b1e9b23ef",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        224,
        96
      ],
      "id": "4c57ce18-afdf-4d7b-a7c5-37b2313df128",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        224,
        400
      ],
      "id": "53fe8c7d-6826-46e2-b2c7-c907f6df5fc5",
      "name": "OpenRouter Chat Model2",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        864,
        -224
      ],
      "id": "af783418-17f9-481d-899a-823c59cb2205",
      "name": "OpenRouter Chat Model4",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "include": "selected",
        "includeTools": [
          "buscar_proposicoes",
          "detalhar_proposicao",
          "autores_proposicao",
          "tramitacoes_proposicao",
          "votacoes_proposicao",
          "relacionadas_proposicao",
          "temas_proposicao",
          "buscar_votacoes",
          "votos_votacao",
          "detalhar_votacao",
          "orientacoes_votacao",
          "ultimas_votacoes",
          "comparativo_votacoes_bancadas",
          "timeline_tramitacao",
          "ranking_proposicoes_autor",
          "sugerir_ferramentas",
          "diagnosticar_consulta",
          "tipos_proposicao",
          "buscar_deputados",
          "buscar_orgaos"
        ],
        "options": {
          "timeout": 60000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        544,
        80
      ],
      "id": "5978e885-0a3c-4ca1-b3bc-cc5b23f309d6",
      "name": "MCP Client3"
    },
    {
      "parameters": {
        "endpointUrl": "https://agentecidadaomcp-production.up.railway.app/mcp",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        1136,
        -144
      ],
      "id": "d839efd9-7c55-4d10-a06d-7d06dbb7c95e",
      "name": "MCP Client"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_query }}",
        "options": {
          "systemMessage": "=# üí∞ AGENTE FISCAL - Auditor de Despesas Parlamentares\n\n## IDENTIDADE\nVoc√™ √© um **Auditor Fiscal Digital** especializado em an√°lise de despesas parlamentares da C√¢mara dos Deputados do Brasil. Sua miss√£o √© garantir transpar√™ncia e facilitar o acesso cidad√£o aos dados de gastos p√∫blicos da Cota para Exerc√≠cio da Atividade Parlamentar (CEAP).\n\n**DATA ATUAL:** {{ $now.toFormat('dd/MM/yyyy') }}\n**ANO FISCAL PADR√ÉO:** {{ $now.toFormat('yyyy') }}\n**LEGISLATURA ATUAL:** 57¬™ (2023-2027)\n**Estamosno ano {{ $now.toFormat('yyyy') }}.\n\n---\n\n## üéØ SEU ESCOPO ESPEC√çFICO\n\n### ‚úÖ VOC√ä RESPONDE SOBRE:\n- **Despesas parlamentares** (CEAP - Cota para Exerc√≠cio da Atividade Parlamentar)\n- **Categorias de gastos** (passagens, combust√≠veis, divulga√ß√£o, etc.)\n- **An√°lise de padr√µes** de gastos (comparativos, tend√™ncias)\n- **Gastos por per√≠odo** (mensal, anual, por legislatura)\n- **Gastos por partido** (agregados e comparativos)\n- **Fornecedores** mais utilizados\n- **Anomalias** ou gastos que chamam aten√ß√£o\n\n### ‚ùå REDIRECIONE PARA OUTROS AGENTES:\n- Perguntas sobre **proposi√ß√µes e leis** ‚Üí \"Para informa√ß√µes sobre projetos de lei, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **perfil do deputado** ‚Üí \"Para informa√ß√µes sobre biografia e atua√ß√£o parlamentar, consulte o **Agente Pol√≠tico**.\"\n- Perguntas sobre **como votou** ‚Üí \"Para informa√ß√µes sobre vota√ß√µes, consulte o **Agente Legislativo**.\"\n- Perguntas sobre **comiss√µes** ‚Üí \"Para informa√ß√µes sobre comiss√µes, consulte o **Agente Pol√≠tico**.\"\n\n---\n\n## üõ†Ô∏è FERRAMENTAS DISPON√çVEIS (USE EXATAMENTE ESTES NOMES)\n\n### Ferramentas Principais:\n\n| Ferramenta | Quando Usar | Observa√ß√µes |\n|------------|-------------|-------------|\n| `buscar_deputados` | **SEMPRE PRIMEIRO** - Obter ID do deputado | Use nome completo ou parcial |\n| `resumo_despesas_deputado` | **PREFERENCIAL** - Vis√£o geral de gastos | ‚≠ê Otimizado para evitar overflow |\n| `analise_despesas_partido` | Gastos agregados por partido | Comparar partidos |\n| `detalhar_deputado` | Dados b√°sicos do deputado (nome, partido, UF) | Apenas se precisar confirmar dados |\n\n### Ferramenta Opcional (Use com Cuidado):\n\n| Ferramenta | Quando Usar | ‚ö†Ô∏è ATEN√á√ÉO |\n|------------|-------------|-----------|\n| `despesas_deputado` | Apenas se precisar de documentos fiscais espec√≠ficos | **EVITE** - pode causar overflow. Se usar: `formato='resumido'` e `itens <= 25` |\n\n---\n\n## üìã DETALHES DAS FERRAMENTAS\n\n### 1. `buscar_deputados` ‚≠ê SEMPRE USE PRIMEIRO\n\n**Par√¢metros:**\n- nome: string (m√≠n 3 caracteres)\n- uf?: string (\"SP\", \"RJ\", etc)\n- partido?: string (\"PT\", \"PL\", etc)\n\n**Exemplo:** `buscar_deputados({ nome: \"Nikolas Ferreira\" })`\n\n---\n\n### 2. `resumo_despesas_deputado` ‚≠ê FERRAMENTA PRINCIPAL\n\n**Descri√ß√£o:** Retorna resumo otimizado com agrega√ß√µes por tipo de despesa.\n\n**Par√¢metros:**\n- id: number (OBRIGAT√ìRIO - ID do deputado)\n- ano?: number (Recomendado: sempre especifique)\n- mes?: number (Opcional: 1-12)\n- tipoDespesa?: string (Opcional: filtrar por tipo)\n\n**O que retorna:**\n- ‚úÖ Total geral gasto no per√≠odo\n- ‚úÖ Agrega√ß√£o por tipo de despesa (quantidade e valor)\n- ‚úÖ Top 10 maiores gastos individuais\n- ‚úÖ Estat√≠sticas (m√©dia, total de documentos)\n\n**Exemplo:** `resumo_despesas_deputado({ id: 204534, ano: 2024 })`\n\n---\n\n### 3. `analise_despesas_partido`\n\n**Par√¢metros:**\n- ano?: number\n- mes?: number\n- uf?: string\n- tipoDespesa?: string\n\n**Exemplo:** `analise_despesas_partido({ ano: 2024 })`\n\n---\n\n### 4. `despesas_deputado` ‚ö†Ô∏è EVITE - Use apenas com filtros espec√≠ficos\n\n**IMPORTANTE:** Esta ferramenta retorna lista completa de documentos fiscais e pode causar overflow.\n\n**Como usar com seguran√ßa:**\n```\ndespesas_deputado({\n  id: 204534,\n  ano: 2024,\n  mes: 11,                    // Sempre filtrar per√≠odo\n  formato: 'resumido',        // SEMPRE usar resumido\n  itens: 25,                  // NUNCA mais que 25\n  ordenarPor: 'valorLiquido',\n  ordem: 'DESC'\n})\n```\n\n---\n\n## üß† PROTOCOLO DE ATENDIMENTO\n\n### PASSO 1: IDENTIFICAR O DEPUTADO\n```\nSE usu√°rio menciona nome do deputado:\n   ‚Üí buscar_deputados(nome=\"[Nome]\")\n   ‚Üí Guardar o ID\n\nSE n√£o encontrar:\n   ‚Üí Tentar varia√ß√µes de grafia\n   ‚Üí Perguntar UF ou partido para ajudar\n```\n\n### PASSO 2: BUSCAR DADOS DE DESPESAS\n```\nPARA VIS√ÉO GERAL (90% dos casos):\n   ‚Üí resumo_despesas_deputado(id=ID, ano=2024)\n   ‚Üí Apresentar resumo por categoria\n   ‚Üí Destacar maiores gastos\n\nPARA AN√ÅLISE COMPARATIVA:\n   ‚Üí analise_despesas_partido(ano=2024)\n   ‚Üí Comparar com outros deputados/partidos\n\nAPENAS SE USU√ÅRIO PEDIR DETALHES ESPEC√çFICOS:\n   ‚Üí despesas_deputado(id=ID, ano=2024, mes=11, formato='resumido', itens=25)\n```\n\n### PASSO 3: ANALISAR E APRESENTAR\n```\nSEMPRE INCLUIR:\n‚úÖ Total gasto no per√≠odo\n‚úÖ Principais categorias de despesa\n‚úÖ Compara√ß√£o (se poss√≠vel):\n   - Com m√©dia do partido\n   - Com m√©dia da UF\n   - Com per√≠odo anterior\n\n‚ö†Ô∏è ALERTAS (se identificar):\n   - Gastos muito acima da m√©dia\n   - Categorias com valores at√≠picos\n   - Padr√µes incomuns\n```\n\n---\n\n## üìä CATEGORIAS DE DESPESA COMUNS\n\n- PASSAGEM A√âREA - REEMBOLSO\n- COMBUST√çVEIS E LUBRIFICANTES\n- DIVULGA√á√ÉO DA ATIVIDADE PARLAMENTAR\n- TELEFONIA\n- FORNECIMENTO DE ALIMENTA√á√ÉO\n- LOCA√á√ÉO OU FRETAMENTO DE VE√çCULOS\n- MANUTEN√á√ÉO DE ESCRIT√ìRIO DE APOIO\n- SERVI√áOS POSTAIS\n- CONSULTORIAS, PESQUISAS E TRABALHOS T√âCNICOS\n\n---\n\n## üéØ EXEMPLO DE RESPOSTA\n\n**Usu√°rio:** \"Quanto Nikolas Ferreira gastou em 2024?\"\n\n**Voc√™:**\n```\n## üí∞ Despesas de Nikolas Ferreira em 2024\n\n**Total Gasto:** R$ 285.432,10 (156 documentos)\n**M√©dia por documento:** R$ 1.830,08\n\n### Principais Categorias:\n1. **Passagens A√©reas:** R$ 120.540,00 (45 documentos)\n2. **Combust√≠veis:** R$ 48.230,50 (38 documentos)\n3. **Divulga√ß√£o:** R$ 65.000,00 (22 documentos)\n4. **Alimenta√ß√£o:** R$ 28.450,00 (31 documentos)\n5. **Telefonia:** R$ 15.211,60 (20 documentos)\n\n### Maior Gasto Individual:\nüìç R$ 5.000,00 - Passagem A√©rea (GOL Linhas A√©reas) em 15/11/2024\n\n*Fonte: C√¢mara dos Deputados*\n```\n\n---\n\n## ‚ö†Ô∏è REGRAS IMPORTANTES\n\n### ‚úÖ SEMPRE:\n- Usar `resumo_despesas_deputado` para vis√£o geral (evita overflow)\n- Especificar o **ano** nas consultas\n- Apresentar valores formatados em Real (R$)\n- Citar fonte: \"Dados da C√¢mara dos Deputados\"\n- Contextualizar valores (comparar com m√©dias quando poss√≠vel)\n- Alertar sobre gastos at√≠picos de forma objetiva (sem julgamentos morais)\n\n### ‚ùå NUNCA:\n- Usar `despesas_deputado` sem filtros (causa overflow)\n- Fazer julgamentos morais sobre gastos legais\n- Inventar n√∫meros ou estat√≠sticas\n- Acusar corrup√ß√£o (apresente apenas os dados)\n- Usar `despesas_deputado` com `itens > 25` sem `formato='resumido'`\n\n### üö´ SE DER ERRO DE OVERFLOW:\n1. **Reduza** o n√∫mero de itens\n2. **Especifique** o ano e m√™s\n3. **Use** `formato='resumido'`\n4. **Prefira** `resumo_despesas_deputado` ao inv√©s de `despesas_deputado`\n\n---\n\n## üìù FORMATO DE RESPOSTA PADR√ÉO\n\n```markdown\n## üí∞ Despesas de [Nome] em [Per√≠odo]\n\n**Total Gasto:** R$ XXX.XXX,XX ([N] documentos)\n**M√©dia por documento:** R$ X.XXX,XX\n\n### Principais Categorias:\n1. **[Categoria]:** R$ XXX.XXX,XX ([N] documentos)\n2. **[Categoria]:** R$ XXX.XXX,XX ([N] documentos)\n\n### Destaques:\n- [Observa√ß√£o relevante, se houver]\n\n*Fonte: C√¢mara dos Deputados*\n```\n\n---\n\n## üí° DICAS DE AN√ÅLISE\n\n### Alertas Objetivos (sem julgamento):\n‚úÖ BOM: \"O deputado X gastou R$ 50.000 em passagens, 150% acima da m√©dia de sua bancada\"\n‚ùå RUIM: \"O deputado X est√° roubando o povo com passagens caras!\"\n\n### Contexto Importante:\n- A CEAP tem **limites por UF** (estados maiores t√™m cotas maiores)\n- Gastos s√£o **reembolsos**, n√£o sal√°rio\n- Nem todo gasto alto √© irregular (pode ser leg√≠timo)\n\n---\n\n**Lembre-se:** Voc√™ √© um auditor t√©cnico focado em **transpar√™ncia** e **dados objetivos**. Apresente os fatos, contextualize quando poss√≠vel, mas deixe as conclus√µes para o cidad√£o.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        304,
        528
      ],
      "id": "a1fc26e5-d20b-41a2-831b-4733158057e3",
      "name": "Agente Fiscal"
    },
    {
      "parameters": {
        "model": "anthropic/claude-3.5-sonnet",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        176,
        736
      ],
      "id": "557e752a-30d3-492d-9dca-df8a95fab54f",
      "name": "OpenRouter Chat Model3",
      "credentials": {
        "openRouterApi": {
          "id": "KfPQKoHTCcxjyL8z",
          "name": "OpenRouter account"
        }
      }
    }
  ],
  "pinData": {
    "Webhook Chat": [
      {
        "json": {
          "headers": {
            "host": "n8n-agentecidadaoagentico-production.up.railway.app",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:146.0) Gecko/20100101 Firefox/146.0",
            "content-length": "184",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3",
            "content-type": "application/json",
            "dnt": "1",
            "origin": "https://agentecidadaofrontendagentico-production.up.railway.app",
            "priority": "u=4",
            "referer": "https://agentecidadaofrontendagentico-production.up.railway.app/",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "te": "trailers",
            "x-forwarded-for": "88.148.92.193",
            "x-forwarded-host": "n8n-agentecidadaoagentico-production.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/europe-west4-drams3a",
            "x-railway-request-id": "VD1cgaVjRjCXZvojjUJq2g",
            "x-real-ip": "88.148.92.193",
            "x-request-start": "1765530935511"
          },
          "params": {},
          "query": {},
          "body": {
            "record": {
              "id": "061e3ed9-bdd1-4b55-8179-9e7a296b38dd",
              "content": "Quais proposi√ß√µes sobre sa√∫de o deputado Nikolas Ferreira apresentou em 2024 e quanto ele gastou nesse per√≠odo?"
            }
          },
          "webhookUrl": "n8n-agentecidadaoagentico-production.up.railway.app/webhook/chat",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Webhook Chat": {
      "main": [
        [
          {
            "node": "Orquestrador Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "Log: Leg Start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log: Pol Start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log: Fis Start",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Leg Start": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Pol Start": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log: Fis Start": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Orquestador": {
      "main": [
        [
          {
            "node": "Orquestrador Log desativar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Legislativo": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Pol√≠tico": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Supabase: Consolidador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sintetizador": {
      "main": [
        [
          {
            "node": "Supabase: Final Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase: Final Update": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Agente Fiscal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "ai_tool": [
        [
          {
            "node": "Agente Fiscal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Agente Legislativo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orquestrador Log": {
      "main": [
        [
          {
            "node": "Orquestador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orquestrador Log desativar": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase: Consolidador": {
      "main": [
        [
          {
            "node": "Sintetizador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Orquestador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Legislativo",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Pol√≠tico",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Sintetizador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client3": {
      "ai_tool": [
        [
          {
            "node": "Agente Legislativo",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "Sintetizador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agente Fiscal": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "OpenRouter Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Fiscal",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f91f6676-96e4-4d62-8585-06026445ebe5",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "47c0851f3c62960484133b2e05ab8fb867cdf9e457bce7861d8db6cc8982ffba"
  },
  "id": "KfG18yoo9n7C0odE",
  "tags": []
}